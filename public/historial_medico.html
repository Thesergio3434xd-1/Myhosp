<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MyHosp - Historial Medico</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet" />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet">
    <!-- Google Fonts - Lexend (Asegurando que esté disponible con todos los pesos) -->
    <link
      href="https://fonts.googleapis.com/css2?family=Lexend:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet">    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="./css/style.css" />
    <!-- Estilos específicos para autenticación -->
    <link rel="stylesheet" href="./css/auth.css" />
    <!-- Estilos del asistente -->
    <link rel="stylesheet" href="./css/asistente.css" />
    <!-- Estilos para el botón de ayuda de Ana -->
    <link rel="stylesheet" href="./css/ana-help-button.css" />
    <!-- Estilos del dashboard -->
    <link rel="stylesheet" href="./css/dashboard.css" />    <!-- Estilos modernos -->
    <link rel="stylesheet" href="./css/modern-design.css" />
    <!-- Estilos específicos del historial médico -->
    <link rel="stylesheet" href="./css/historial-medico.css" />
    <!-- Estilos unificados para notificaciones -->
    <link rel="stylesheet" href="./css/notifications.css" />
  </head>
  <body>
    <!-- Asistente de voz Ana -->
    <div id="ana-assistant" class="voice-assistant">
      <!-- Botones para controlar el asistente -->
      <div class="assistant-controls">
        <button id="enableAssistant"
          class="control-button enable-button"
          aria-label="Activar asistente de voz">
          <i class="fas fa-toggle-on"></i>
        </button>
        <button id="disableAssistant"
          class="control-button disable-button"
          aria-label="Desactivar asistente de voz">
          <i class="fas fa-toggle-off"></i>
        </button>
      </div>
      <button id="micButton" class="mic-button"
        aria-label="Activar asistente de voz">
        <i id="micIcon" class="fas fa-microphone"></i>
      </button>
      <div id="assistantStatus" class="assistant-status"></div>
    </div>    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 px-0">
                <div class="sidebar d-flex flex-column position-fixed vh-100" style="width: 16.666667%; z-index: 1030;">
                    <div class="text-center py-3">
                        <div class="logo">
                            <img src="./img/logo.png" alt="MyHosp Logo" width="60" height="60" class="logo-image mb-2">
                            <h5 class="text-white fw-bold mb-0">MyHosp</h5>
                            <small class="text-white-50 fw-medium">Sistema Hospitalario</small>
                        </div>
                    </div>
                    
                    <nav class="nav flex-column flex-grow-1 px-3">
                        <a class="nav-link" href="dashboard.index.html">
                            <i class="bi bi-house-door"></i> Dashboard
                        </a>
                        <a class="nav-link" href="ver_citas.html">
                            <i class="bi bi-calendar3"></i> Mis Citas
                        </a>
                        <a class="nav-link" href="crear_citas.html">
                            <i class="bi bi-calendar-plus"></i> Nueva Cita
                        </a>
                        <a class="nav-link active" href="historial_medico.html">
                            <i class="bi bi-folder2-open"></i> Historial Médico
                        </a>
                        <a class="nav-link" href="consultas_online.html">
                            <i class="bi bi-camera-video"></i> Consulta Online
                        </a>
                        <a class="nav-link" href="perfil.html">
                            <i class="bi bi-person"></i> Mi Perfil
                        </a>
                        <a class="nav-link" href="Ayuda.html">
                            <i class="bi bi-question-circle"></i> Ayuda
                        </a>
                    </nav>
                    
                    <div class="mt-auto p-3">
                        <button class="logout-btn w-100" onclick="handleLogout()">
                            <i class="bi bi-box-arrow-left me-2"></i> Cerrar Sesión
                        </button>
                    </div>
                </div>
                
                <!-- Overlay para móvil -->
                <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
            </div>

            <!-- Contenido Principal -->
            <div class="col-md-9 col-lg-10" style="margin-left: 16.666667%;">                <!-- Topbar -->
                <div class="topbar d-flex justify-content-between align-items-center px-4" style="height: 70px;">
                    <div class="d-flex align-items-center">
                        <!-- Botón hamburguesa para móvil -->
                        <button class="mobile-menu-toggle me-3" type="button" onclick="toggleSidebar()">
                            <i class="bi bi-list fs-5"></i>
                        </button>
                        <div>
                            <h4 class="text-white mb-0">¡Bienvenido, <span id="username">Neymar Tapias</span>!</h4>
                            <div class="d-flex align-items-center gap-2">
                                <span class="text-white-50">Historial Médico</span>
                                <span class="text-white-50">•</span>
                                <span class="text-white-50 current-time"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-center gap-3">
                        <!-- Dropdown idioma -->
                        <div class="dropdown language-dropdown">
                            <button class="btn btn-language text-white d-flex align-items-center gap-2" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <div class="flag-container">
                                    <img src="https://flagcdn.com/w24/co.png" alt="ES" width="20" height="15" class="flag-image">
                                </div>
                                <span class="language-text">ES</span>
                                <i class="bi bi-chevron-down small"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end language-menu">
                                <li>
                                    <a class="dropdown-item language-option" href="#" data-lang="es">
                                        <img src="https://flagcdn.com/w24/co.png" alt="ES" width="20" height="15" class="flag-image me-2">
                                        <span>Español</span>
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item language-option" href="#" data-lang="en">
                                        <img src="https://flagcdn.com/w24/us.png" alt="EN" width="20" height="15" class="flag-image me-2">
                                        <span>English</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Notificaciones -->
                        <div class="dropdown notifications-dropdown">
                            <button class="btn btn-notification text-white position-relative" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-bell fs-5"></i>
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger notification-badge">3</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end notifications-menu" style="min-width: 300px;">
                                <li class="dropdown-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">Notificaciones</h6>
                                        <small class="text-muted">3 nuevas</small>
                                    </div>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item notification-item" href="#">
                                        <div class="d-flex align-items-start">
                                            <div class="notification-icon bg-primary">
                                                <i class="bi bi-calendar-check text-white"></i>
                                            </div>
                                            <div class="notification-content">
                                                <p class="mb-1 fw-medium">Cita confirmada</p>
                                                <small class="text-muted">Dr. García - Mañana 10:30 AM</small>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item notification-item" href="#">
                                        <div class="d-flex align-items-start">
                                            <div class="notification-icon bg-success">
                                                <i class="bi bi-chat-dots text-white"></i>
                                            </div>
                                            <div class="notification-content">
                                                <p class="mb-1 fw-medium">Mensaje del doctor</p>
                                                <small class="text-muted">Resultados de exámenes listos</small>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item notification-item" href="#">
                                        <div class="d-flex align-items-start">
                                            <div class="notification-icon bg-warning">
                                                <i class="bi bi-exclamation-triangle text-white"></i>
                                            </div>
                                            <div class="notification-content">
                                                <p class="mb-1 fw-medium">Recordatorio</p>
                                                <small class="text-muted">Tomar medicamento a las 8:00 PM</small>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item text-center text-primary" href="#">
                                        Ver todas las notificaciones
                                    </a>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Perfil de usuario -->
                        <div class="dropdown user-profile-dropdown">
                            <button class="btn btn-user-profile text-white d-flex align-items-center gap-2" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop&crop=face" alt="Usuario" width="40" class="rounded-circle user-avatar">
                                <div class="user-info-text d-none d-md-block">
                                    <span class="user-name">Neymar Tapias</span>
                                    <small class="user-role d-block text-white-50">Paciente</small>
                                </div>
                                <i class="bi bi-chevron-down small d-none d-md-inline"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end user-menu">
                                <li class="dropdown-header">
                                    <div class="d-flex align-items-center">
                                        <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=50&h=50&fit=crop&crop=face" alt="Usuario" width="50" class="rounded-circle me-3">
                                        <div>
                                            <h6 class="mb-0">Neymar Tapias</h6>
                                            <small class="text-muted">paciente@myhosp.com</small>
                                        </div>
                                    </div>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="perfil.html">
                                        <i class="bi bi-person me-2 text-primary"></i>Mi Perfil
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="editar_perfil.html">
                                        <i class="bi bi-gear me-2 text-secondary"></i>Configuración
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="Ayuda.html">
                                        <i class="bi bi-question-circle me-2 text-info"></i>Ayuda
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item text-danger" href="#" onclick="handleLogout()">
                                        <i class="bi bi-box-arrow-left me-2"></i>Cerrar Sesión
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>                <!-- Main Content -->
                <div class="main-content">
                    <!-- Contenido principal -->
                    <div class="content p-4">
        <!-- Estadísticas del historial -->
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="card stat-card bg-primary text-white">
              <div class="card-body text-center">
                <i class="bi bi-files fs-1 mb-2"></i>
                <h5 class="card-title">12</h5>
                <p class="card-text">Total Documentos</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card stat-card bg-success text-white">
              <div class="card-body text-center">
                <i class="bi bi-calendar-check fs-1 mb-2"></i>
                <h5 class="card-title">8</h5>
                <p class="card-text">Últimos 30 días</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card stat-card bg-warning text-white">
              <div class="card-body text-center">
                <i class="bi bi-clock-history fs-1 mb-2"></i>
                <h5 class="card-title">3</h5>
                <p class="card-text">Pendientes</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card stat-card bg-info text-white">
              <div class="card-body text-center">
                <i class="bi bi-calendar3 fs-1 mb-2"></i>
                <h5 class="card-title">2025</h5>
                <p class="card-text">Año actual</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Filtros y categorías -->
        <div class="card mb-4">
          <div class="card-body">
            <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
              <div class="d-flex flex-wrap gap-2 mb-2 mb-md-0">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                  <i class="bi bi-plus-circle me-1"></i>Nueva categoría
                </button>
                <button class="btn btn-outline-secondary filter-btn active" data-filter="all">Todos</button>
                <button class="btn btn-outline-secondary filter-btn" data-filter="general">General</button>
                <button class="btn btn-outline-secondary filter-btn" data-filter="examenes">Exámenes Médicos</button>
                <button class="btn btn-outline-secondary filter-btn" data-filter="medicina">Medicina General</button>
              </div>
              
              <div class="d-flex gap-2">
                <button class="btn btn-success" id="uploadBtn">
                  <i class="bi bi-upload me-1"></i>Subir Documento
                </button>
                <input type="file" id="fileInput" class="d-none" accept=".pdf,.doc,.docx,.jpg,.png">
              </div>
            </div>

            <!-- Barra de búsqueda mejorada -->
            <div class="row">
              <div class="col-md-6">
                <div class="input-group">
                  <input type="text" class="form-control" id="searchInput"
                    placeholder="Buscar por nombre, fecha o categoría...">
                  <button class="btn btn-primary" id="searchBtn">
                    <i class="bi bi-search"></i>
                  </button>
                </div>
              </div>
              <div class="col-md-3">
                <select class="form-select" id="dateFilter">
                  <option value="">Filtrar por fecha</option>
                  <option value="today">Hoy</option>
                  <option value="week">Última semana</option>
                  <option value="month">Último mes</option>
                  <option value="year">Último año</option>
                </select>
              </div>
              <div class="col-md-3">
                <select class="form-select" id="typeFilter">
                  <option value="">Todos los tipos</option>
                  <option value="consulta">Consultas</option>
                  <option value="examen">Exámenes</option>
                  <option value="receta">Recetas</option>
                  <option value="vacuna">Vacunas</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Lista de documentos -->
        <div class="card">
          <div class="card-body">
            <h4 class="card-title text-center mb-4 text-primary">
              <i class="bi bi-folder2-open me-2"></i>
              Documentos del historial médico
            </h4>            <div class="row g-4">
              <!-- Primera fila -->
              <div class="col-md-6">
                <div class="card document-card card-bordered-red position-relative" 
                     data-category="medicina" 
                     data-type="consulta" 
                     data-date="2023-05-14" 
                     data-title="Medicina General">
                  <div class="card-img-container">
                    <span class="star-grey">&#9734;</span>
                    <span class="card-header-icons">&#8942;</span>
                    <img src="img/documento.png" class="card-img-top" alt="Medicina General" />
                  </div>
                  <div class="card-body text-center">
                    <h6 class="card-title">Medicina General</h6>
                    <p class="text-date">May 14, 2023. 13:25 PM</p>
                    <div class="card-actions mt-2">
                      <button class="btn btn-sm btn-primary me-1" onclick="viewDocument(this)">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-success me-1" onclick="downloadDocument(this)">
                        <i class="bi bi-download"></i>
                      </button>
                      <button class="btn btn-sm btn-danger" onclick="deleteDocument(this)">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="card document-card card-bordered-green position-relative"
                     data-category="examenes" 
                     data-type="examen" 
                     data-date="2023-05-14" 
                     data-title="Examen de sangre">
                  <div class="card-img-container">
                    <span class="star-yellow">&#9733;</span>
                    <span class="card-header-icons">&#8942;</span>
                    <img src="img/documento.png" class="card-img-top" alt="Examen de sangre" />
                  </div>
                  <div class="card-body text-center">
                    <h6 class="card-title">Examen de sangre</h6>
                    <p class="text-date">May 14, 2023. 13:25 PM</p>
                    <div class="card-actions mt-2">
                      <button class="btn btn-sm btn-primary me-1" onclick="viewDocument(this)">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-success me-1" onclick="downloadDocument(this)">
                        <i class="bi bi-download"></i>
                      </button>
                      <button class="btn btn-sm btn-danger" onclick="deleteDocument(this)">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Segunda fila -->
              <div class="col-md-6">
                <div class="card document-card position-relative"
                     data-category="psicologia" 
                     data-type="consulta" 
                     data-date="2023-04-20" 
                     data-title="Psicólogo">
                  <div class="card-img-container">
                    <span class="star-yellow">&#9733;</span>
                    <span class="card-header-icons">&#8942;</span>
                    <img src="img/documento.png" class="card-img-top" alt="Psicólogo" />
                  </div>
                  <div class="card-body text-center">
                    <h6 class="card-title">Psicólogo</h6>
                    <p class="text-date">Apr 20, 2023. 10:15 AM</p>
                    <div class="card-actions mt-2">
                      <button class="btn btn-sm btn-primary me-1" onclick="viewDocument(this)">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-success me-1" onclick="downloadDocument(this)">
                        <i class="bi bi-download"></i>
                      </button>
                      <button class="btn btn-sm btn-danger" onclick="deleteDocument(this)">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="card document-card position-relative"
                     data-category="nutricion" 
                     data-type="consulta" 
                     data-date="2023-03-15" 
                     data-title="Nutricionista">
                  <div class="card-img-container">
                    <span class="star-grey">&#9734;</span>
                    <span class="card-header-icons">&#8942;</span>
                    <img src="img/documento.png" class="card-img-top" alt="Nutricionista" />
                  </div>
                  <div class="card-body text-center">
                    <h6 class="card-title">Nutricionista</h6>
                    <p class="text-date">Mar 15, 2023. 14:30 PM</p>
                    <div class="card-actions mt-2">
                      <button class="btn btn-sm btn-primary me-1" onclick="viewDocument(this)">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-success me-1" onclick="downloadDocument(this)">
                        <i class="bi bi-download"></i>
                      </button>
                      <button class="btn btn-sm btn-danger" onclick="deleteDocument(this)">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Tercera fila -->
              <div class="col-md-6">
                <div class="card document-card card-bordered-blue position-relative"
                     data-category="vacunas" 
                     data-type="vacuna" 
                     data-date="2023-02-10" 
                     data-title="Vacuna COVID-19">
                  <div class="card-img-container">
                    <span class="star-grey">&#9734;</span>
                    <span class="card-header-icons">&#8942;</span>
                    <img src="img/documento.png" class="card-img-top" alt="Vacuna COVID-19" />
                  </div>
                  <div class="card-body text-center">
                    <h6 class="card-title">Vacuna COVID-19</h6>
                    <p class="text-date">Feb 10, 2023. 09:00 AM</p>
                    <div class="card-actions mt-2">
                      <button class="btn btn-sm btn-primary me-1" onclick="viewDocument(this)">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-success me-1" onclick="downloadDocument(this)">
                        <i class="bi bi-download"></i>
                      </button>
                      <button class="btn btn-sm btn-danger" onclick="deleteDocument(this)">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="card document-card card-bordered-orange position-relative"
                     data-category="recetas" 
                     data-type="receta" 
                     data-date="2023-01-25" 
                     data-title="Receta Médica">
                  <div class="card-img-container">
                    <span class="star-yellow">&#9733;</span>
                    <span class="card-header-icons">&#8942;</span>
                    <img src="img/documento.png" class="card-img-top" alt="Receta Médica" />
                  </div>
                  <div class="card-body text-center">
                    <h6 class="card-title">Receta Médica</h6>
                    <p class="text-date">Jan 25, 2023. 16:45 PM</p>
                    <div class="card-actions mt-2">
                      <button class="btn btn-sm btn-primary me-1" onclick="viewDocument(this)">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-success me-1" onclick="downloadDocument(this)">
                        <i class="bi bi-download"></i>
                      </button>
                      <button class="btn btn-sm btn-danger" onclick="deleteDocument(this)">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal para agregar nueva categoría -->

    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static"
      data-bs-keyboard="false" tabindex="-1"
      aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title text-center" id="staticBackdropLabel"
              style="color: #0d99b4;">Crear categoria del historial medico</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"
              aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="nombreCategoria" class="form-label">Nombre de la
                  categoría</label>
                <input type="text" class="form-control" id="nombreCategoria"
                  placeholder="Ingrese el nombre de la categoría">
              </div>

              <div class="mb-3">
                <label for="descripcionCategoria"
                  class="form-label">Descripción</label>
                <input type="text" class="form-control"
                  id="descripcionCategoria"
                  placeholder="Ingrese la descripción de la categoría">
              </div>              <div class="mb-3">
                <label for="colorCategoria" class="form-label">Color de la
                  categoría</label>
                <input type="color" class="form-control"
                  id="colorCategoria"
                  value="#0d99b4">
              </div>

              <div class="mb-4">
                <label for="formFile" class="form-label">Default file input example</label>
                <input class="form-control" type="file" id="formFile">
              </div>
            </form>
          </div>          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              <i class="bi bi-x-circle me-1"></i>Cancelar
            </button>
            <button type="button" class="btn btn-primary" onclick="createCategory()">
              <i class="bi bi-plus-circle me-1"></i>Crear Categoría
            </button>
          </div>
        </div>
      </div>
    </div>

    
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <!-- Script de notificación inicial para el asistente -->
  <script src="./js/activation-prompt.js"></script>
  
  <!-- Script para notificación inicial sobre capacidades de Ana -->
  <script src="./js/initial-notification.js"></script>
  
  <!-- Script de consentimiento para Ana -->
  <script src="./js/ana-consent.js"></script>
  
  <!-- Script para controlar los botones del asistente -->
  <script src="./js/assistant-controls.js"></script>
  <!-- Asistente de voz -->
  <script type="module" src="./js/ViewModels/assistant.js"></script>
    <!-- Botón de ayuda de Ana -->
  <script src="./js/ana-help-button.js"></script>
  <script>    // Verificar autenticación al cargar la página
    document.addEventListener('DOMContentLoaded', function() {
      // Verificar si el usuario está logueado
      if (!localStorage.getItem('userLoggedIn')) {
        window.location.href = 'login.html';
        return;
      }      // Actualizar nombre del usuario si está disponible
      const userName = localStorage.getItem('userName');
      if (userName) {
        const usernameSpan = document.getElementById('username');
        if (usernameSpan) {
          usernameSpan.textContent = userName;
        }
      }

      // Inicializar funciones del navbar
      initializeNavbar();
      
      // Actualizar reloj en tiempo real
      updateCurrentTime();
      setInterval(updateCurrentTime, 1000);

      // Funcionalidad de logout desde navbar y dropdown
      document.addEventListener('click', function(e) {
        if (e.target.closest('.logout-btn') || e.target.getAttribute('onclick') === 'handleLogout()') {
          e.preventDefault();
          handleLogout();
        }
      });

      // Inicializar funcionalidades de la página
      initializeFilters();
      initializeSearch();
      initializeFileUpload();
      initializeDocumentActions();
    });    // Funciones del navbar moderno
    function initializeNavbar() {
      // Funcionalidad para móvil
      window.toggleSidebar = function() {
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.sidebar-overlay');
        
        if (sidebar && overlay) {
          sidebar.classList.toggle('show');
          overlay.classList.toggle('show');
        }
      };
    }

    // Función de logout centralizada
    function handleLogout() {
      if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
        // Limpiar datos de sesión
        localStorage.removeItem('userLoggedIn');
        localStorage.removeItem('userDocument');
        localStorage.removeItem('userName');
        
        // Redirigir al login
        window.location.href = 'login.html';
      }
    }    // Actualizar reloj en tiempo real
    function updateCurrentTime() {
      const currentTimeElement = document.querySelector('.current-time');
      if (currentTimeElement) {
        const now = new Date();
        const timeString = now.toLocaleTimeString('es-ES', {
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        });
        const dateString = now.toLocaleDateString('es-ES', {
          weekday: 'short',
          day: 'numeric',
          month: 'short'
        });
        currentTimeElement.textContent = `${dateString} ${timeString}`;
      }
    }

    // Funcionalidad de filtros
    function initializeFilters() {
      const filterButtons = document.querySelectorAll('.filter-btn');
      const typeFilter = document.getElementById('typeFilter');
      const dateFromFilter = document.getElementById('dateFrom');
      const dateToFilter = document.getElementById('dateTo');

      // Filtros por categoría (botones)
      filterButtons.forEach(btn => {
        btn.addEventListener('click', function() {
          // Remover clase activa de todos los botones
          filterButtons.forEach(b => b.classList.remove('active'));
          
          // Agregar clase activa al botón clickeado
          this.classList.add('active');
          
          // Aplicar filtro
          const filter = this.getAttribute('data-filter');
          filterDocuments(filter, typeFilter.value, dateFromFilter.value, dateToFilter.value);
        });
      });

      // Filtros por tipo y fecha
      typeFilter.addEventListener('change', function() {
        const activeFilter = document.querySelector('.filter-btn.active')?.getAttribute('data-filter') || 'all';
        filterDocuments(activeFilter, this.value, dateFromFilter.value, dateToFilter.value);
      });

      dateFromFilter.addEventListener('change', function() {
        const activeFilter = document.querySelector('.filter-btn.active')?.getAttribute('data-filter') || 'all';
        filterDocuments(activeFilter, typeFilter.value, this.value, dateToFilter.value);
      });

      dateToFilter.addEventListener('change', function() {
        const activeFilter = document.querySelector('.filter-btn.active')?.getAttribute('data-filter') || 'all';
        filterDocuments(activeFilter, typeFilter.value, dateFromFilter.value, this.value);
      });
    }

    // Función para filtrar documentos
    function filterDocuments(category, type, dateFrom, dateTo) {
      const documentCards = document.querySelectorAll('.card[data-category]');
      let visibleCount = 0;

      documentCards.forEach(card => {
        let shouldShow = true;

        // Filtro por categoría
        if (category !== 'all') {
          const cardCategory = card.getAttribute('data-category');
          if (cardCategory !== category) {
            shouldShow = false;
          }
        }

        // Filtro por tipo
        if (type && shouldShow) {
          const cardType = card.getAttribute('data-type');
          if (cardType !== type) {
            shouldShow = false;
          }
        }

        // Filtro por fecha
        if ((dateFrom || dateTo) && shouldShow) {
          const cardDate = new Date(card.getAttribute('data-date'));
          
          if (dateFrom) {
            const fromDate = new Date(dateFrom);
            if (cardDate < fromDate) {
              shouldShow = false;
            }
          }
          
          if (dateTo && shouldShow) {
            const toDate = new Date(dateTo);
            if (cardDate > toDate) {
              shouldShow = false;
            }
          }
        }

        // Mostrar u ocultar tarjeta
        if (shouldShow) {
          card.style.display = 'block';
          card.parentElement.style.display = 'block';
          visibleCount++;
        } else {
          card.style.display = 'none';
          card.parentElement.style.display = 'none';
        }
      });

      // Actualizar contador de resultados
      updateResultsCounter(visibleCount);
    }

    // Función de búsqueda en tiempo real
    function initializeSearch() {
      const searchInput = document.getElementById('searchInput');
      
      if (searchInput) {
        searchInput.addEventListener('input', function() {
          const searchTerm = this.value.toLowerCase();
          const documentCards = document.querySelectorAll('.card[data-title]');
          let visibleCount = 0;

          documentCards.forEach(card => {
            const title = card.getAttribute('data-title').toLowerCase();
            const shouldShow = title.includes(searchTerm);

            if (shouldShow) {
              card.style.display = 'block';
              card.parentElement.style.display = 'block';
              visibleCount++;
            } else {
              card.style.display = 'none';
              card.parentElement.style.display = 'none';
            }
          });

          updateResultsCounter(visibleCount);
        });
      }
    }

    // Funcionalidad de subida de archivos
    function initializeFileUpload() {
      const fileInput = document.getElementById('formFile');
      
      if (fileInput) {
        fileInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          
          if (file) {
            // Validar tipo de archivo
            const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png', 'image/jpg'];
            
            if (!allowedTypes.includes(file.type)) {
              alert('Tipo de archivo no permitido. Solo se aceptan PDF, JPG, PNG');
              this.value = '';
              return;
            }
            
            // Validar tamaño (máximo 5MB)
            if (file.size > 5 * 1024 * 1024) {
              alert('El archivo es demasiado grande. Máximo 5MB permitido');
              this.value = '';
              return;
            }
            
            // Mostrar preview del archivo
            showFilePreview(file);
          }
        });
      }
    }

    // Mostrar preview del archivo
    function showFilePreview(file) {
      const previewContainer = document.getElementById('filePreview') || createFilePreviewContainer();
      
      previewContainer.innerHTML = `
        <div class="alert alert-info d-flex align-items-center">
          <i class="fas fa-file-upload me-2"></i>
          <div>
            <strong>Archivo seleccionado:</strong> ${file.name}<br>
            <small>Tamaño: ${(file.size / 1024 / 1024).toFixed(2)} MB</small>
          </div>
          <button type="button" class="btn btn-sm btn-outline-danger ms-auto" onclick="removeFilePreview()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
    }

    // Crear contenedor de preview si no existe
    function createFilePreviewContainer() {
      const container = document.createElement('div');
      container.id = 'filePreview';
      container.className = 'mb-3';
      
      const fileInput = document.getElementById('formFile');
      fileInput.parentNode.insertBefore(container, fileInput.nextSibling);
      
      return container;
    }

    // Remover preview del archivo
    function removeFilePreview() {
      const fileInput = document.getElementById('formFile');
      const previewContainer = document.getElementById('filePreview');
      
      if (fileInput) fileInput.value = '';
      if (previewContainer) previewContainer.innerHTML = '';
    }

    // Acciones de documentos (favoritos, opciones)
    function initializeDocumentActions() {
      // Funcionalidad de favoritos
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('star-grey') || e.target.classList.contains('star-yellow')) {
          toggleFavorite(e.target);
        }
        
        if (e.target.textContent === '⋮') {
          showDocumentOptions(e.target);
        }
      });
    }

    // Toggle favorito
    function toggleFavorite(starElement) {
      if (starElement.classList.contains('star-grey')) {
        starElement.className = 'star-yellow';
        starElement.innerHTML = '&#9733;';
        showNotification('Documento agregado a favoritos', 'success');
      } else {
        starElement.className = 'star-grey';
        starElement.innerHTML = '&#9734;';
        showNotification('Documento removido de favoritos', 'info');
      }
    }

    // Mostrar opciones de documento
    function showDocumentOptions(optionsElement) {
      const rect = optionsElement.getBoundingClientRect();
      
      // Remover menús existentes
      const existingMenu = document.querySelector('.document-options-menu');
      if (existingMenu) {
        existingMenu.remove();
      }
      
      const menu = document.createElement('div');
      menu.className = 'document-options-menu';
      menu.style.cssText = `
        position: fixed;
        top: ${rect.bottom + 5}px;
        left: ${rect.left - 100}px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        z-index: 1000;
        min-width: 120px;
      `;
      
      menu.innerHTML = `
        <div class="p-2">
          <button class="btn btn-sm btn-outline-primary w-100 mb-1" onclick="viewDocument(this)">
            <i class="fas fa-eye"></i> Ver
          </button>
          <button class="btn btn-sm btn-outline-secondary w-100 mb-1" onclick="downloadDocument(this)">
            <i class="fas fa-download"></i> Descargar
          </button>
          <button class="btn btn-sm btn-outline-danger w-100" onclick="deleteDocument(this)">
            <i class="fas fa-trash"></i> Eliminar
          </button>
        </div>
      `;
      
      document.body.appendChild(menu);
      
      // Cerrar menú al hacer clic fuera
      setTimeout(() => {
        document.addEventListener('click', function closeMenu(e) {
          if (!menu.contains(e.target)) {
            menu.remove();
            document.removeEventListener('click', closeMenu);
          }
        });
      }, 100);
    }

    // Actualizar contador de resultados
    function updateResultsCounter(count) {
      let counter = document.getElementById('resultsCounter');
      if (!counter) {
        counter = document.createElement('div');
        counter.id = 'resultsCounter';
        counter.className = 'text-muted mb-3';
        
        const container = document.querySelector('.bg-white.p-4.shadow.rounded');
        const title = container.querySelector('h2');
        title.parentNode.insertBefore(counter, title.nextSibling);
      }
      
      counter.textContent = `Mostrando ${count} documento${count !== 1 ? 's' : ''}`;
    }

    // Acciones de documentos
    function viewDocument(btn) {
      showNotification('Abriendo documento...', 'info');
      // Aquí iría la lógica para abrir el documento
    }

    function downloadDocument(btn) {
      showNotification('Descargando documento...', 'info');
      // Aquí iría la lógica para descargar el documento
    }

    function deleteDocument(btn) {
      if (confirm('¿Estás seguro de que deseas eliminar este documento?')) {
        showNotification('Documento eliminado', 'success');
        // Aquí iría la lógica para eliminar el documento
      }
    }

    // Sistema de notificaciones
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} notification`;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        min-width: 300px;
        animation: slideIn 0.3s ease-out;
      `;
      
      notification.innerHTML = `
        <div class="d-flex align-items-center">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
          ${message}
          <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Auto-remove después de 5 segundos
      setTimeout(() => {
        if (notification.parentNode) {
          notification.remove();
        }
      }, 5000);
    }

    // Validación del formulario de categoría
    function validateCategoryForm() {
      const name = document.getElementById('nombreCategoria').value.trim();
      const description = document.getElementById('descripcionCategoria').value.trim();
      
      if (!name) {
        showNotification('El nombre de la categoría es obligatorio', 'error');
        return false;
      }
      
      if (!description) {
        showNotification('La descripción de la categoría es obligatoria', 'error');
        return false;
      }
      
      return true;
    }

    // Crear categoría
    function createCategory() {
      if (validateCategoryForm()) {
        const name = document.getElementById('nombreCategoria').value.trim();
        const description = document.getElementById('descripcionCategoria').value.trim();
        const color = document.getElementById('colorCategoria').value;
        
        // Aquí iría la lógica para crear la categoría
        showNotification(`Categoría "${name}" creada exitosamente`, 'success');
        
        // Cerrar modal
        const modal = bootstrap.Modal.getInstance(document.querySelector('.modal'));
        if (modal) {
          modal.hide();
        }
        
        // Limpiar formulario
        document.getElementById('nombreCategoria').value = '';
        document.getElementById('descripcionCategoria').value = '';
        document.getElementById('colorCategoria').value = '#000000';
      }
    }    // Agregar estilos CSS dinámicos modernos
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
      }
      
      .filter-btn.active {
        background-color: var(--primary-color) !important;
        color: white !important;
        border-color: var(--primary-color) !important;
      }
      
      .document-options-menu {
        animation: fadeIn 0.2s ease-out;
      }
      
      .star-grey:hover, .star-yellow:hover {
        cursor: pointer;
        transform: scale(1.1);
        transition: transform 0.2s;
      }
      
      .card-header-icons:hover {
        cursor: pointer;
        background-color: rgba(255,255,255,0.1);
        border-radius: 50%;
        padding: 2px;
      }
      
      .document-card {
        transition: all 0.3s ease;
        border: 1px solid rgba(0,0,0,0.125);
      }
      
      .document-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        border-color: var(--primary-color);
      }
      
      .stat-card {
        transition: all 0.3s ease;
      }
      
      .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      }
      
      .card-actions {
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      
      .document-card:hover .card-actions {
        opacity: 1;
      }
      
      .notification-dropdown {
        width: 320px;
        max-height: 400px;
        overflow-y: auto;
      }
      
      .notification-item {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #eee;
      }
      
      .notification-item:hover {
        background-color: #f8f9fa;
      }
      
      .notification-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 0.75rem;
        flex-shrink: 0;
      }
      
      .notification-content {
        flex: 1;
      }
      
      .notification-title {
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
        color: #333;
      }
      
      .notification-text {
        font-size: 0.8rem;
        color: #666;
        margin-bottom: 0.25rem;
      }
      
      .notification-time {
        font-size: 0.75rem;
        color: #999;
      }
    `;
    document.head.appendChild(style);
  </script>
  </body>
</html>