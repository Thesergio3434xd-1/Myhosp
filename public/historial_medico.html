<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyHosp - Historial Médico</title>
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Estilos base modernos -->
    <link rel="stylesheet" href="./css/modern-design.css">
    
    <!-- Estilos específicos para historial médico -->
    <link rel="stylesheet" href="./css/historial-medico.css">
    
    <!-- Asistente de voz -->
    <link rel="stylesheet" href="./css/asistente.css">
    <link rel="stylesheet" href="./css/ana-help-button.css">
    
    <!-- Notificaciones -->
    <link rel="stylesheet" href="./css/notifications.css">
</head>  <body>
    <!-- Asistente de voz Ana -->
    <div id="ana-assistant" class="voice-assistant">
        <div class="assistant-controls">
            <button id="enableAssistant" class="control-button enable-button" aria-label="Activar asistente de voz">
                <i class="bi bi-toggle-on"></i>
            </button>
            <button id="disableAssistant" class="control-button disable-button" aria-label="Desactivar asistente de voz">
                <i class="bi bi-toggle-off"></i>
            </button>
        </div>
        <button id="micButton" class="mic-button" aria-label="Activar asistente de voz">
            <i id="micIcon" class="bi bi-mic"></i>
        </button>
        <div id="assistantStatus" class="assistant-status"></div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <img src="img/logo.png" alt="MyHosp Logo" class="logo-img">
                <span class="logo-text">MyHosp</span>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="dashboard.index.html" class="nav-item">
                <i class="bi bi-house-door"></i>
                <span>Dashboard</span>
            </a>
            <a href="ver_citas.html" class="nav-item">
                <i class="bi bi-calendar-check"></i>
                <span>Mis Citas</span>
            </a>
            <a href="historial_medico.html" class="nav-item active">
                <i class="bi bi-file-medical"></i>
                <span>Historial Médico</span>
            </a>
            <a href="consultas_online.html" class="nav-item">
                <i class="bi bi-camera-video"></i>
                <span>Consultas Online</span>
            </a>
            <a href="perfil.html" class="nav-item">
                <i class="bi bi-person-circle"></i>
                <span>Mi Perfil</span>
            </a>
            <a href="ayuda.html" class="nav-item">
                <i class="bi bi-question-circle"></i>
                <span>Ayuda & Soporte</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <a href="index.html" class="logout-btn" id="logoutBtn">
                <i class="bi bi-box-arrow-left"></i>
                <span>Cerrar Sesión</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Topbar -->
        <div class="topbar">
            <div class="topbar-left">
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="bi bi-list"></i>
                </button>
                <div class="page-title">
                    <h1>Historial Médico</h1>
                    <p>Gestiona y consulta tu historia clínica completa</p>
                </div>
            </div>
            
            <div class="topbar-right">
                <!-- Selector de idioma -->
                <div class="dropdown">
                    <button class="btn btn-topbar dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown">
                        <img src="https://flagcdn.com/w24/co.png" alt="ES" width="20" height="15">
                        <span>ES</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                            <a class="dropdown-item" href="#">
                                <img src="https://flagcdn.com/w24/co.png" alt="ES" width="20" height="15">
                                Español
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="#">
                                <img src="https://flagcdn.com/w24/us.png" alt="EN" width="20" height="15">
                                English
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Notificaciones -->
                <div class="notification-bell">
                    <button class="btn btn-topbar" id="notificationBtn">
                        <i class="bi bi-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>
                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-header">
                            <h6>Notificaciones</h6>
                            <button class="btn-clear-all">Marcar todas como leídas</button>
                        </div>
                        <div class="notification-list">
                            <div class="notification-item unread">
                                <div class="notification-icon bg-success">
                                    <i class="bi bi-file-medical"></i>
                                </div>
                                <div class="notification-content">
                                    <p><strong>Nuevo resultado de laboratorio</strong></p>
                                    <small>Examen de sangre completado - hace 2 horas</small>
                                </div>
                            </div>
                            <div class="notification-item unread">
                                <div class="notification-icon bg-info">
                                    <i class="bi bi-calendar-check"></i>
                                </div>
                                <div class="notification-content">
                                    <p><strong>Recordatorio de cita</strong></p>
                                    <small>Consulta mañana a las 10:00 AM</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Perfil del usuario -->
                <div class="dropdown">
                    <button class="btn btn-profile dropdown-toggle" type="button" id="profileDropdown" data-bs-toggle="dropdown">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User" class="profile-img">
                        <div class="profile-info">
                            <span class="profile-name">Neymar Tapias</span>
                            <small class="profile-role">Paciente</small>
                        </div>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="perfil.html"><i class="bi bi-person"></i> Mi Perfil</a></li>
                        <li><a class="dropdown-item" href="editar_perfil.html"><i class="bi bi-gear"></i> Configuración</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="ayuda.html"><i class="bi bi-question-circle"></i> Ayuda</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Contenido principal -->
        <div class="historial-container">            <!-- Header del historial -->
            <div class="historial-header">
                <div class="historial-header-content">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2 class="historial-title">Mi Historial Médico</h2>
                            <p class="historial-subtitle">Acceso completo a tu información médica y documentos clínicos</p>
                            <div class="historial-stats">
                                <div class="stat-item">
                                    <i class="bi bi-file-medical"></i>
                                    <span class="stat-number">12</span>
                                    <span class="stat-label">Documentos</span>
                                </div>
                                <div class="stat-item">
                                    <i class="bi bi-calendar3"></i>
                                    <span class="stat-number">8</span>
                                    <span class="stat-label">Este mes</span>
                                </div>
                                <div class="stat-item">
                                    <i class="bi bi-clock-history"></i>
                                    <span class="stat-number">2 días</span>
                                    <span class="stat-label">Último registro</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-light btn-lg" id="uploadDocumentBtn">
                                <i class="bi bi-cloud-upload"></i>
                                Subir Documento
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estadísticas y resumen -->
            <div class="historial-overview">
                <div class="row g-4 mb-4">
                    <div class="col-md-3">
                        <div class="overview-card primary">
                            <div class="overview-icon">
                                <i class="bi bi-file-earmark-medical"></i>
                            </div>
                            <div class="overview-content">
                                <h3>12</h3>
                                <p>Total Documentos</p>
                                <span class="overview-trend positive">
                                    <i class="bi bi-arrow-up"></i> +3 este mes
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="overview-card success">
                            <div class="overview-icon">
                                <i class="bi bi-check-circle"></i>
                            </div>
                            <div class="overview-content">
                                <h3>8</h3>
                                <p>Completados</p>
                                <span class="overview-trend positive">
                                    <i class="bi bi-arrow-up"></i> +2 esta semana
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="overview-card warning">
                            <div class="overview-icon">
                                <i class="bi bi-clock"></i>
                            </div>
                            <div class="overview-content">
                                <h3>3</h3>
                                <p>Pendientes</p>
                                <span class="overview-trend neutral">
                                    <i class="bi bi-dash"></i> Sin cambios
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="overview-card info">
                            <div class="overview-icon">
                                <i class="bi bi-star"></i>
                            </div>
                            <div class="overview-content">
                                <h3>5</h3>
                                <p>Favoritos</p>
                                <span class="overview-trend positive">
                                    <i class="bi bi-arrow-up"></i> +1 reciente
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filtros y herramientas -->
            <div class="historial-filters">
                <div class="filters-header">
                    <h3>Buscar y Filtrar</h3>
                    <div class="filters-actions">
                        <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#newCategoryModal">
                            <i class="bi bi-plus-lg"></i>
                            Nueva Categoría
                        </button>
                        <button class="btn btn-primary" id="uploadBtn">
                            <i class="bi bi-upload"></i>
                            Subir Archivo
                        </button>
                        <input type="file" id="fileInput" class="d-none" accept=".pdf,.doc,.docx,.jpg,.png,.jpeg">
                    </div>
                </div>

                <div class="filters-content">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="search-box">
                                <i class="bi bi-search"></i>
                                <input type="text" id="searchInput" placeholder="Buscar por nombre, fecha o tipo de documento...">
                                <button class="search-clear" id="clearSearch">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="categoryFilter">
                                <option value="">Todas las categorías</option>
                                <option value="general">General</option>
                                <option value="examenes">Exámenes Médicos</option>
                                <option value="medicina">Medicina General</option>
                                <option value="vacunas">Vacunas</option>
                                <option value="recetas">Recetas</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="dateFilter">
                                <option value="">Todas las fechas</option>
                                <option value="today">Hoy</option>
                                <option value="week">Última semana</option>
                                <option value="month">Último mes</option>
                                <option value="year">Último año</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="statusFilter">
                                <option value="">Todos los estados</option>
                                <option value="completed">Completados</option>
                                <option value="pending">Pendientes</option>
                                <option value="favorites">Favoritos</option>
                            </select>
                        </div>
                    </div>

                    <!-- Filtros rápidos -->
                    <div class="quick-filters">
                        <button class="quick-filter active" data-filter="all">
                            <i class="bi bi-collection"></i>
                            Todos
                        </button>
                        <button class="quick-filter" data-filter="recent">
                            <i class="bi bi-clock"></i>
                            Recientes
                        </button>
                        <button class="quick-filter" data-filter="favorites">
                            <i class="bi bi-star"></i>
                            Favoritos
                        </button>
                        <button class="quick-filter" data-filter="pending">
                            <i class="bi bi-hourglass"></i>
                            Pendientes
                        </button>
                        <button class="quick-filter" data-filter="examenes">
                            <i class="bi bi-clipboard-data"></i>
                            Exámenes
                        </button>
                        <button class="quick-filter" data-filter="recetas">
                            <i class="bi bi-prescription2"></i>
                            Recetas
                        </button>
                    </div>
                </div>
            </div>

            <!-- Timeline del historial médico -->
            <div class="historial-timeline">
                <h3 class="timeline-title">
                    <i class="bi bi-clock-history"></i>
                    Línea de Tiempo Médica
                </h3>

                <div class="timeline-container">
                    <div class="timeline-item">
                        <div class="timeline-marker success">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <div class="card-meta">
                                        <span class="card-date">15 Enero 2025 - 10:30 AM</span>
                                        <span class="card-category medicina">Medicina General</span>
                                    </div>
                                    <div class="card-actions">
                                        <button class="btn-action favorite" data-id="1">
                                            <i class="bi bi-star"></i>
                                        </button>
                                        <button class="btn-action share" data-id="1">
                                            <i class="bi bi-share"></i>
                                        </button>
                                        <button class="btn-action more" data-id="1">
                                            <i class="bi bi-three-dots"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <h4>Consulta de Medicina General</h4>
                                    <p>Control rutinario de salud general. Revisión de signos vitales y estado físico.</p>
                                    <div class="card-details">
                                        <div class="detail-item">
                                            <i class="bi bi-person-badge"></i>
                                            <span>Dr. Carlos Rodríguez</span>
                                        </div>
                                        <div class="detail-item">
                                            <i class="bi bi-hospital"></i>
                                            <span>Clínica San José</span>
                                        </div>
                                    </div>
                                    <div class="card-attachments">
                                        <div class="attachment">
                                            <i class="bi bi-file-earmark-pdf text-danger"></i>
                                            <span>Historia_Clinica_15012025.pdf</span>
                                            <button class="btn-download">
                                                <i class="bi bi-download"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker warning">
                            <i class="bi bi-clock"></i>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <div class="card-meta">
                                        <span class="card-date">12 Enero 2025 - 8:00 AM</span>
                                        <span class="card-category examenes">Exámenes</span>
                                    </div>
                                    <div class="card-actions">
                                        <button class="btn-action favorite active" data-id="2">
                                            <i class="bi bi-star-fill"></i>
                                        </button>
                                        <button class="btn-action share" data-id="2">
                                            <i class="bi bi-share"></i>
                                        </button>
                                        <button class="btn-action more" data-id="2">
                                            <i class="bi bi-three-dots"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <h4>Examen de Sangre Completo</h4>
                                    <p>Análisis completo de sangre incluyendo hemograma, química sanguínea y perfil lipídico.</p>
                                    <div class="card-status pending">
                                        <i class="bi bi-hourglass-split"></i>
                                        <span>Resultados pendientes</span>
                                    </div>
                                    <div class="card-details">
                                        <div class="detail-item">
                                            <i class="bi bi-geo-alt"></i>
                                            <span>Laboratorio Central</span>
                                        </div>
                                        <div class="detail-item">
                                            <i class="bi bi-person-check"></i>
                                            <span>Dra. Ana Martínez</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker info">
                            <i class="bi bi-prescription2"></i>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <div class="card-meta">
                                        <span class="card-date">8 Enero 2025 - 3:45 PM</span>
                                        <span class="card-category recetas">Medicamentos</span>
                                    </div>
                                    <div class="card-actions">
                                        <button class="btn-action favorite" data-id="3">
                                            <i class="bi bi-star"></i>
                                        </button>
                                        <button class="btn-action share" data-id="3">
                                            <i class="bi bi-share"></i>
                                        </button>
                                        <button class="btn-action more" data-id="3">
                                            <i class="bi bi-three-dots"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <h4>Receta Médica</h4>
                                    <p>Medicamentos prescritos para tratamiento de infección respiratoria.</p>
                                    <div class="medications-list">
                                        <div class="medication-item">
                                            <i class="bi bi-capsule"></i>
                                            <div class="medication-info">
                                                <span class="medication-name">Amoxicilina 500mg</span>
                                                <small>1 tableta cada 8 horas por 7 días</small>
                                            </div>
                                        </div>
                                        <div class="medication-item">
                                            <i class="bi bi-droplet"></i>
                                            <div class="medication-info">
                                                <span class="medication-name">Jarabe para la tos</span>
                                                <small>5ml cada 6 horas según necesidad</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-details">
                                        <div class="detail-item">
                                            <i class="bi bi-person-badge"></i>
                                            <span>Dr. Luis García</span>
                                        </div>
                                        <div class="detail-item">
                                            <i class="bi bi-calendar-event"></i>
                                            <span>Válida hasta: 15 Feb 2025</span>
                                        </div>
                                    </div>
                                    <div class="card-attachments">
                                        <div class="attachment">
                                            <i class="bi bi-file-earmark-medical text-primary"></i>
                                            <span>Receta_08012025.pdf</span>
                                            <button class="btn-download">
                                                <i class="bi bi-download"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker primary">
                            <i class="bi bi-shield-check"></i>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <div class="card-meta">
                                        <span class="card-date">5 Enero 2025 - 11:15 AM</span>
                                        <span class="card-category vacunas">Vacunas</span>
                                    </div>
                                    <div class="card-actions">
                                        <button class="btn-action favorite" data-id="4">
                                            <i class="bi bi-star"></i>
                                        </button>
                                        <button class="btn-action share" data-id="4">
                                            <i class="bi bi-share"></i>
                                        </button>
                                        <button class="btn-action more" data-id="4">
                                            <i class="bi bi-three-dots"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <h4>Vacunación COVID-19 (Refuerzo)</h4>
                                    <p>Aplicación de dosis de refuerzo de vacuna contra COVID-19.</p>
                                    <div class="vaccine-info">
                                        <div class="vaccine-details">
                                            <span class="vaccine-type">Pfizer-BioNTech</span>
                                            <span class="vaccine-lot">Lote: AB123456</span>
                                        </div>
                                        <div class="vaccine-status completed">
                                            <i class="bi bi-check-circle-fill"></i>
                                            <span>Completada</span>
                                        </div>
                                    </div>
                                    <div class="card-details">
                                        <div class="detail-item">
                                            <i class="bi bi-geo-alt"></i>
                                            <span>Centro de Vacunación Norte</span>
                                        </div>
                                        <div class="detail-item">
                                            <i class="bi bi-calendar-plus"></i>
                                            <span>Próxima dosis: 5 Jul 2025</span>
                                        </div>
                                    </div>
                                    <div class="card-attachments">
                                        <div class="attachment">
                                            <i class="bi bi-file-earmark-check text-success"></i>
                                            <span>Certificado_Vacunacion.pdf</span>
                                            <button class="btn-download">
                                                <i class="bi bi-download"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botón para cargar más -->
                <div class="timeline-load-more">
                    <button class="btn btn-outline-primary" id="loadMoreBtn">
                        <i class="bi bi-arrow-down-circle"></i>
                        Cargar más registros
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para nueva categoría -->
    <div class="modal fade" id="newCategoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Nueva Categoría</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="newCategoryForm">
                        <div class="mb-3">
                            <label for="categoryName" class="form-label">Nombre de la categoría</label>
                            <input type="text" class="form-control" id="categoryName" required>
                        </div>
                        <div class="mb-3">
                            <label for="categoryDescription" class="form-label">Descripción</label>
                            <textarea class="form-control" id="categoryDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="categoryColor" class="form-label">Color</label>
                            <input type="color" class="form-control form-control-color" id="categoryColor" value="#0d99b4">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveCategoryBtn">Guardar Categoría</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para subir documentos -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Subir Documento Médico</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadForm">
                        <div class="upload-zone" id="uploadZone">
                            <div class="upload-icon">
                                <i class="bi bi-cloud-upload"></i>
                            </div>
                            <h4>Arrastra tus archivos aquí</h4>
                            <p>o haz clic para seleccionar archivos</p>
                            <small>Formatos soportados: PDF, DOC, DOCX, JPG, PNG (Máx. 10MB)</small>
                            <input type="file" id="uploadFileInput" multiple accept=".pdf,.doc,.docx,.jpg,.png,.jpeg">
                        </div>
                        
                        <div class="upload-details mt-4" id="uploadDetails" style="display: none;">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="documentTitle" class="form-label">Título del documento</label>
                                    <input type="text" class="form-control" id="documentTitle" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="documentCategory" class="form-label">Categoría</label>
                                    <select class="form-select" id="documentCategory" required>
                                        <option value="">Seleccionar categoría</option>
                                        <option value="general">General</option>
                                        <option value="examenes">Exámenes Médicos</option>
                                        <option value="medicina">Medicina General</option>
                                        <option value="vacunas">Vacunas</option>
                                        <option value="recetas">Recetas</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <label for="documentDate" class="form-label">Fecha del documento</label>
                                    <input type="date" class="form-control" id="documentDate" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="documentDoctor" class="form-label">Médico/Institución</label>
                                    <input type="text" class="form-control" id="documentDoctor">
                                </div>
                            </div>
                            <div class="mt-3">
                                <label for="documentNotes" class="form-label">Notas adicionales</label>
                                <textarea class="form-control" id="documentNotes" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="uploadDocumentBtn" disabled>
                        <i class="bi bi-upload"></i>
                        Subir Documento
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <!-- Script de notificación inicial para el asistente -->
  <script src="./js/activation-prompt.js"></script>
  
  <!-- Script para notificación inicial sobre capacidades de Ana -->
  <script src="./js/initial-notification.js"></script>
  
  <!-- Script de consentimiento para Ana -->
  <script src="./js/ana-consent.js"></script>
  
  <!-- Script para controlar los botones del asistente -->
  <script src="./js/assistant-controls.js"></script>
  <!-- Asistente de voz -->
  <script type="module" src="./js/ViewModels/assistant.js"></script>
    <!-- Botón de ayuda de Ana -->
  <script src="./js/ana-help-button.js"></script>
  <script>
    // Verificar autenticación al cargar la página
    document.addEventListener('DOMContentLoaded', function() {
      // Verificar si el usuario está logueado
      if (!localStorage.getItem('userLoggedIn')) {
        window.location.href = 'login.html';
        return;
      }

      // Actualizar nombre del usuario si está disponible
      const userName = localStorage.getItem('userName');
      if (userName) {
        const userGreeting = document.getElementById('userGreeting');
        if (userGreeting) {
          userGreeting.textContent = `Hola, ${userName}`;
        }
      }

      // Funcionalidad de logout
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
          e.preventDefault();
          if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
            // Limpiar datos de sesión
            localStorage.removeItem('userLoggedIn');
            localStorage.removeItem('userDocument');
            localStorage.removeItem('userName');
            
            // Redirigir al login
            window.location.href = 'login.html';
          }
        });
      }

      // Inicializar funcionalidades de la página
      initializeFilters();
      initializeSearch();
      initializeFileUpload();
      initializeDocumentActions();
    });

    // Funcionalidad de filtros
    function initializeFilters() {
      const filterButtons = document.querySelectorAll('.filter-btn');
      const typeFilter = document.getElementById('typeFilter');
      const dateFromFilter = document.getElementById('dateFrom');
      const dateToFilter = document.getElementById('dateTo');

      // Filtros por categoría (botones)
      filterButtons.forEach(btn => {
        btn.addEventListener('click', function() {
          // Remover clase activa de todos los botones
          filterButtons.forEach(b => b.classList.remove('active'));
          
          // Agregar clase activa al botón clickeado
          this.classList.add('active');
          
          // Aplicar filtro
          const filter = this.getAttribute('data-filter');
          filterDocuments(filter, typeFilter.value, dateFromFilter.value, dateToFilter.value);
        });
      });

      // Filtros por tipo y fecha
      typeFilter.addEventListener('change', function() {
        const activeFilter = document.querySelector('.filter-btn.active')?.getAttribute('data-filter') || 'all';
        filterDocuments(activeFilter, this.value, dateFromFilter.value, dateToFilter.value);
      });

      dateFromFilter.addEventListener('change', function() {
        const activeFilter = document.querySelector('.filter-btn.active')?.getAttribute('data-filter') || 'all';
        filterDocuments(activeFilter, typeFilter.value, this.value, dateToFilter.value);
      });

      dateToFilter.addEventListener('change', function() {
        const activeFilter = document.querySelector('.filter-btn.active')?.getAttribute('data-filter') || 'all';
        filterDocuments(activeFilter, typeFilter.value, dateFromFilter.value, this.value);
      });
    }

    // Función para filtrar documentos
    function filterDocuments(category, type, dateFrom, dateTo) {
      const documentCards = document.querySelectorAll('.card[data-category]');
      let visibleCount = 0;

      documentCards.forEach(card => {
        let shouldShow = true;

        // Filtro por categoría
        if (category !== 'all') {
          const cardCategory = card.getAttribute('data-category');
          if (cardCategory !== category) {
            shouldShow = false;
          }
        }

        // Filtro por tipo
        if (type && shouldShow) {
          const cardType = card.getAttribute('data-type');
          if (cardType !== type) {
            shouldShow = false;
          }
        }

        // Filtro por fecha
        if ((dateFrom || dateTo) && shouldShow) {
          const cardDate = new Date(card.getAttribute('data-date'));
          
          if (dateFrom) {
            const fromDate = new Date(dateFrom);
            if (cardDate < fromDate) {
              shouldShow = false;
            }
          }
          
          if (dateTo && shouldShow) {
            const toDate = new Date(dateTo);
            if (cardDate > toDate) {
              shouldShow = false;
            }
          }
        }

        // Mostrar u ocultar tarjeta
        if (shouldShow) {
          card.style.display = 'block';
          card.parentElement.style.display = 'block';
          visibleCount++;
        } else {
          card.style.display = 'none';
          card.parentElement.style.display = 'none';
        }
      });

      // Actualizar contador de resultados
      updateResultsCounter(visibleCount);
    }

    // Función de búsqueda en tiempo real
    function initializeSearch() {
      const searchInput = document.getElementById('searchInput');
      
      if (searchInput) {
        searchInput.addEventListener('input', function() {
          const searchTerm = this.value.toLowerCase();
          const documentCards = document.querySelectorAll('.card[data-title]');
          let visibleCount = 0;

          documentCards.forEach(card => {
            const title = card.getAttribute('data-title').toLowerCase();
            const shouldShow = title.includes(searchTerm);

            if (shouldShow) {
              card.style.display = 'block';
              card.parentElement.style.display = 'block';
              visibleCount++;
            } else {
              card.style.display = 'none';
              card.parentElement.style.display = 'none';
            }
          });

          updateResultsCounter(visibleCount);
        });
      }
    }

    // Funcionalidad de subida de archivos
    function initializeFileUpload() {
      const fileInput = document.getElementById('formFile');
      
      if (fileInput) {
        fileInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          
          if (file) {
            // Validar tipo de archivo
            const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png', 'image/jpg'];
            
            if (!allowedTypes.includes(file.type)) {
              alert('Tipo de archivo no permitido. Solo se aceptan PDF, JPG, PNG');
              this.value = '';
              return;
            }
            
            // Validar tamaño (máximo 5MB)
            if (file.size > 5 * 1024 * 1024) {
              alert('El archivo es demasiado grande. Máximo 5MB permitido');
              this.value = '';
              return;
            }
            
            // Mostrar preview del archivo
            showFilePreview(file);
          }
        });
      }
    }

    // Mostrar preview del archivo
    function showFilePreview(file) {
      const previewContainer = document.getElementById('filePreview') || createFilePreviewContainer();
      
      previewContainer.innerHTML = `
        <div class="alert alert-info d-flex align-items-center">
          <i class="fas fa-file-upload me-2"></i>
          <div>
            <strong>Archivo seleccionado:</strong> ${file.name}<br>
            <small>Tamaño: ${(file.size / 1024 / 1024).toFixed(2)} MB</small>
          </div>
          <button type="button" class="btn btn-sm btn-outline-danger ms-auto" onclick="removeFilePreview()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
    }

    // Crear contenedor de preview si no existe
    function createFilePreviewContainer() {
      const container = document.createElement('div');
      container.id = 'filePreview';
      container.className = 'mb-3';
      
      const fileInput = document.getElementById('formFile');
      fileInput.parentNode.insertBefore(container, fileInput.nextSibling);
      
      return container;
    }

    // Remover preview del archivo
    function removeFilePreview() {
      const fileInput = document.getElementById('formFile');
      const previewContainer = document.getElementById('filePreview');
      
      if (fileInput) fileInput.value = '';
      if (previewContainer) previewContainer.innerHTML = '';
    }

    // Acciones de documentos (favoritos, opciones)
    function initializeDocumentActions() {
      // Funcionalidad de favoritos
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('star-grey') || e.target.classList.contains('star-yellow')) {
          toggleFavorite(e.target);
        }
        
        if (e.target.textContent === '⋮') {
          showDocumentOptions(e.target);
        }
      });
    }

    // Toggle favorito
    function toggleFavorite(starElement) {
      if (starElement.classList.contains('star-grey')) {
        starElement.className = 'star-yellow';
        starElement.innerHTML = '&#9733;';
        showNotification('Documento agregado a favoritos', 'success');
      } else {
        starElement.className = 'star-grey';
        starElement.innerHTML = '&#9734;';
        showNotification('Documento removido de favoritos', 'info');
      }
    }

    // Mostrar opciones de documento
    function showDocumentOptions(optionsElement) {
      const rect = optionsElement.getBoundingClientRect();
      
      // Remover menús existentes
      const existingMenu = document.querySelector('.document-options-menu');
      if (existingMenu) {
        existingMenu.remove();
      }
      
      const menu = document.createElement('div');
      menu.className = 'document-options-menu';
      menu.style.cssText = `
        position: fixed;
        top: ${rect.bottom + 5}px;
        left: ${rect.left - 100}px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        z-index: 1000;
        min-width: 120px;
      `;
      
      menu.innerHTML = `
        <div class="p-2">
          <button class="btn btn-sm btn-outline-primary w-100 mb-1" onclick="viewDocument(this)">
            <i class="fas fa-eye"></i> Ver
          </button>
          <button class="btn btn-sm btn-outline-secondary w-100 mb-1" onclick="downloadDocument(this)">
            <i class="fas fa-download"></i> Descargar
          </button>
          <button class="btn btn-sm btn-outline-danger w-100" onclick="deleteDocument(this)">
            <i class="fas fa-trash"></i> Eliminar
          </button>
        </div>
      `;
      
      document.body.appendChild(menu);
      
      // Cerrar menú al hacer clic fuera
      setTimeout(() => {
        document.addEventListener('click', function closeMenu(e) {
          if (!menu.contains(e.target)) {
            menu.remove();
            document.removeEventListener('click', closeMenu);
          }
        });
      }, 100);
    }

    // Actualizar contador de resultados
    function updateResultsCounter(count) {
      let counter = document.getElementById('resultsCounter');
      if (!counter) {
        counter = document.createElement('div');
        counter.id = 'resultsCounter';
        counter.className = 'text-muted mb-3';
        
        const container = document.querySelector('.bg-white.p-4.shadow.rounded');
        const title = container.querySelector('h2');
        title.parentNode.insertBefore(counter, title.nextSibling);
      }
      
      counter.textContent = `Mostrando ${count} documento${count !== 1 ? 's' : ''}`;
    }

    // Acciones de documentos
    function viewDocument(btn) {
      showNotification('Abriendo documento...', 'info');
      // Aquí iría la lógica para abrir el documento
    }

    function downloadDocument(btn) {
      showNotification('Descargando documento...', 'info');
      // Aquí iría la lógica para descargar el documento
    }

    function deleteDocument(btn) {
      if (confirm('¿Estás seguro de que deseas eliminar este documento?')) {
        showNotification('Documento eliminado', 'success');
        // Aquí iría la lógica para eliminar el documento
      }
    }

    // Sistema de notificaciones
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} notification`;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        min-width: 300px;
        animation: slideIn 0.3s ease-out;
      `;
      
      notification.innerHTML = `
        <div class="d-flex align-items-center">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
          ${message}
          <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Auto-remove después de 5 segundos
      setTimeout(() => {
        if (notification.parentNode) {
          notification.remove();
        }
      }, 5000);
    }

    // Validación del formulario de categoría
    function validateCategoryForm() {
      const name = document.getElementById('nombreCategoria').value.trim();
      const description = document.getElementById('descripcionCategoria').value.trim();
      
      if (!name) {
        showNotification('El nombre de la categoría es obligatorio', 'error');
        return false;
      }
      
      if (!description) {
        showNotification('La descripción de la categoría es obligatoria', 'error');
        return false;
      }
      
      return true;
    }

    // Crear categoría
    function createCategory() {
      if (validateCategoryForm()) {
        const name = document.getElementById('nombreCategoria').value.trim();
        const description = document.getElementById('descripcionCategoria').value.trim();
        const color = document.getElementById('colorCategoria').value;
        
        // Aquí iría la lógica para crear la categoría
        showNotification(`Categoría "${name}" creada exitosamente`, 'success');
        
        // Cerrar modal
        const modal = bootstrap.Modal.getInstance(document.querySelector('.modal'));
        if (modal) {
          modal.hide();
        }
        
        // Limpiar formulario
        document.getElementById('nombreCategoria').value = '';
        document.getElementById('descripcionCategoria').value = '';
        document.getElementById('colorCategoria').value = '#000000';
      }
    }

    // Agregar estilos CSS dinámicos
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      
      .filter-btn.active {
        background-color: #0d99b4 !important;
        color: white !important;
        border-color: #0d99b4 !important;
      }
      
      .document-options-menu {
        animation: fadeIn 0.2s ease-out;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
      }
      
      .star-grey:hover, .star-yellow:hover {
        cursor: pointer;
        transform: scale(1.1);
        transition: transform 0.2s;
      }
      
      .card-header-icons:hover {
        cursor: pointer;
        background-color: #f8f9fa;
        border-radius: 50%;
      }
    `;
    document.head.appendChild(style);
  </script>
  </body>
</html>