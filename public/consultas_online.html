<!DOCTYPE html>
<html lang="es">  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyHosp - Consultas Online</title>
    
    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Estilos modernos -->
    <link rel="stylesheet" href="./css/modern-design.css">
    
    <!-- Estilos específicos del asistente -->
    <link rel="stylesheet" href="./css/asistente.css">
    <link rel="stylesheet" href="./css/ana-help-button.css">
  </head>
  <body>    <!-- Asistente de voz Ana -->
    <div id="ana-assistant" class="voice-assistant">
      <!-- Botones para controlar el asistente -->
      <div class="assistant-controls">
        <button id="enableAssistant"
          class="control-button enable-button"
          aria-label="Activar asistente de voz">
          <i class="bi bi-toggle-on"></i>
        </button>
        <button id="disableAssistant"
          class="control-button disable-button"
          aria-label="Desactivar asistente de voz">
          <i class="bi bi-toggle-off"></i>
        </button>
      </div>
      <button id="micButton" class="mic-button"
        aria-label="Activar asistente de voz">
        <i id="micIcon" class="bi bi-mic"></i>
      </button>
      <div id="assistantStatus" class="assistant-status"></div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <img src="https://images.unsplash.com/photo-1551190822-a9333d879b1f?w=100&h=100&fit=crop&crop=center" alt="MyHosp Logo" class="logo-img">
          <span class="logo-text">MyHosp</span>
        </div>
      </div>
      
      <nav class="sidebar-nav">
        <a href="dashboard.index.html" class="nav-item">
          <i class="bi bi-house-door"></i>
          <span>Dashboard</span>
        </a>
        <a href="citas.html" class="nav-item">
          <i class="bi bi-calendar-check"></i>
          <span>Mis Citas</span>
        </a>
        <a href="crear_nueva_cita.html" class="nav-item">
          <i class="bi bi-calendar-plus"></i>
          <span>Nueva Cita</span>
        </a>
        <a href="historial_medico.html" class="nav-item">
          <i class="bi bi-file-medical"></i>
          <span>Historial Médico</span>
        </a>
        <a href="consultas_online.html" class="nav-item active">
          <i class="bi bi-camera-video"></i>
          <span>Consultas Online</span>
        </a>
        <a href="perfil.html" class="nav-item">
          <i class="bi bi-person-circle"></i>
          <span>Mi Perfil</span>
        </a>
        <a href="ayuda.html" class="nav-item">
          <i class="bi bi-question-circle"></i>
          <span>Ayuda & Soporte</span>
        </a>
      </nav>
      
      <div class="sidebar-footer">
        <a href="index.html" class="logout-btn">
          <i class="bi bi-box-arrow-left"></i>
          <span>Cerrar Sesión</span>
        </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Topbar -->
      <div class="topbar">
        <div class="topbar-left">
          <button class="sidebar-toggle" id="sidebarToggle">
            <i class="bi bi-list"></i>
          </button>
          <div class="page-title">
            <h1>Consultas Online</h1>
            <p>Consulta médica desde la comodidad de tu hogar</p>
          </div>
        </div>
        
        <div class="topbar-right">
          <!-- Dropdown idioma -->
          <div class="dropdown">
            <button class="topbar-btn dropdown-toggle" type="button" id="dropdownIdioma" 
                    data-bs-toggle="dropdown" aria-expanded="false">
              <img src="https://flagcdn.com/w24/co.png" alt="ES" width="20" height="15">
              <span>ES</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li>
                <a class="dropdown-item" href="#">
                  <img src="https://flagcdn.com/w24/co.png" alt="ES" width="20" height="15">
                  Español
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="#">
                  <img src="https://flagcdn.com/w24/us.png" alt="EN" width="20" height="15">
                  English
                </a>
              </li>
            </ul>
          </div>

          <!-- Notificaciones -->
          <div class="dropdown">
            <button class="topbar-btn position-relative" type="button" 
                    data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-bell"></i>
              <span class="notification-badge">2</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end notification-dropdown">
              <li class="dropdown-header">Notificaciones (2)</li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item notification-item" href="#">
                  <div class="notification-icon bg-info">
                    <i class="bi bi-camera-video"></i>
                  </div>
                  <div class="notification-content">
                    <span class="notification-title">Consulta próxima</span>
                    <span class="notification-text">Tu consulta con Dr. García comienza en 15 min</span>
                    <span class="notification-time">Hace 2 min</span>
                  </div>
                </a>
              </li>
            </ul>
          </div>

          <!-- Perfil de usuario -->
          <div class="dropdown">
            <button class="topbar-btn user-btn dropdown-toggle" type="button" 
                    id="dropdownPerfil" data-bs-toggle="dropdown" aria-expanded="false">
              <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face" 
                   alt="Usuario" class="user-avatar">
              <div class="user-info">
                <span class="user-name">Neymar Tapias</span>
                <span class="user-role">Paciente</span>
              </div>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="perfil.html"><i class="bi bi-person"></i> Mi Perfil</a></li>
              <li><a class="dropdown-item" href="editar_perfil.html"><i class="bi bi-gear"></i> Configuración</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="index.html"><i class="bi bi-box-arrow-right"></i> Cerrar Sesión</a></li>
            </ul>
          </div>
        </div>
      </div>      <!-- Contenido principal -->
      <div class="page-content">
        
        <!-- Hero Section para Consultas Online -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="hero-section">
              <div class="hero-content">
                <div class="hero-text">
                  <h2>Consulta Médica Online</h2>
                  <p>Accede a atención médica profesional desde la comodidad de tu hogar</p>
                  <div class="hero-features">
                    <div class="feature-item">
                      <i class="bi bi-shield-check"></i>
                      <span>100% Seguro</span>
                    </div>
                    <div class="feature-item">
                      <i class="bi bi-clock"></i>
                      <span>24/7 Disponible</span>
                    </div>
                    <div class="feature-item">
                      <i class="bi bi-camera-video"></i>
                      <span>HD Video</span>
                    </div>
                  </div>
                </div>
                <div class="hero-image">
                  <img src="https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=300&fit=crop&crop=center" 
                       alt="Consulta Online" class="img-fluid">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Navigation Pills -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="glass-card">
              <nav class="consultation-nav">
                <button class="nav-tab active" data-tab="upcoming">
                  <i class="bi bi-calendar-event"></i>
                  <span>Próximas Consultas</span>
                  <span class="tab-badge">3</span>
                </button>
                <button class="nav-tab" data-tab="completed">
                  <i class="bi bi-check-circle"></i>
                  <span>Consultas Completadas</span>
                </button>
                <button class="nav-tab" data-tab="specialists">
                  <i class="bi bi-people"></i>
                  <span>Especialistas Disponibles</span>
                </button>
              </nav>
            </div>
          </div>
        </div>

        <!-- Upcoming Consultations Content -->
        <div id="upcoming-content" class="tab-content active">
          <div class="row">
            <!-- Consulta Inmediata -->
            <div class="col-lg-4 mb-4">
              <div class="consultation-card urgent">
                <div class="card-header">
                  <div class="status-badge urgent">
                    <i class="bi bi-exclamation-circle"></i>
                    En 15 minutos
                  </div>
                  <div class="consultation-type">
                    <i class="bi bi-camera-video"></i>
                    Videollamada
                  </div>
                </div>
                
                <div class="doctor-info">
                  <div class="doctor-avatar">
                    <img src="https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=100&h=100&fit=crop&crop=face" 
                         alt="Dr. Pablo Ruiz">
                    <div class="status-indicator online"></div>
                  </div>
                  <div class="doctor-details">
                    <h5>Dr. Pablo Ruiz Hernández</h5>
                    <span class="specialty">Medicina General</span>
                    <div class="experience">4 años de experiencia</div>
                    <div class="rating">
                      <div class="stars">
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-half"></i>
                      </div>
                      <span>4.8 (89 reseñas)</span>
                    </div>
                  </div>
                </div>

                <div class="consultation-details">
                  <div class="detail-row">
                    <i class="bi bi-calendar3"></i>
                    <span>Hoy, 2:00 PM - 2:30 PM</span>
                  </div>
                  <div class="detail-row">
                    <i class="bi bi-geo-alt"></i>
                    <span>Consulta Virtual</span>
                  </div>
                  <div class="detail-row">
                    <i class="bi bi-clipboard2-pulse"></i>
                    <span>Consulta de rutina</span>
                  </div>
                </div>

                <div class="card-actions">
                  <button class="btn btn-primary btn-start-call" onclick="startVideoCall('Dr. Pablo Ruiz Hernández', 'medicina general')">
                    <i class="bi bi-camera-video me-2"></i>
                    Iniciar Consulta
                  </button>
                  <button class="btn btn-outline-secondary">
                    <i class="bi bi-chat-dots"></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Consulta Programada -->
            <div class="col-lg-4 mb-4">
              <div class="consultation-card scheduled">
                <div class="card-header">
                  <div class="status-badge scheduled">
                    <i class="bi bi-clock"></i>
                    Programada
                  </div>
                  <div class="consultation-type">
                    <i class="bi bi-camera-video"></i>
                    Videollamada
                  </div>
                </div>
                
                <div class="doctor-info">
                  <div class="doctor-avatar">
                    <img src="https://images.unsplash.com/photo-1594824731083-7fb4b02c7a4e?w=100&h=100&fit=crop&crop=face" 
                         alt="Dra. Amanda Otero">
                    <div class="status-indicator online"></div>
                  </div>
                  <div class="doctor-details">
                    <h5>Dra. Amanda Otero Ramos</h5>
                    <span class="specialty">Psicología</span>
                    <div class="experience">12 años de experiencia</div>
                    <div class="rating">
                      <div class="stars">
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                      </div>
                      <span>5.0 (156 reseñas)</span>
                    </div>
                  </div>
                </div>

                <div class="consultation-details">
                  <div class="detail-row">
                    <i class="bi bi-calendar3"></i>
                    <span>Lunes, 10:00 AM - 11:00 AM</span>
                  </div>
                  <div class="detail-row">
                    <i class="bi bi-geo-alt"></i>
                    <span>Consulta Virtual</span>
                  </div>
                  <div class="detail-row">
                    <i class="bi bi-clipboard2-pulse"></i>
                    <span>Terapia psicológica</span>
                  </div>
                </div>

                <div class="card-actions">
                  <button class="btn btn-outline-primary" disabled>
                    <i class="bi bi-calendar-check me-2"></i>
                    Programada
                  </button>
                  <button class="btn btn-outline-secondary">
                    <i class="bi bi-pencil"></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Consulta Pendiente -->
            <div class="col-lg-4 mb-4">
              <div class="consultation-card pending">
                <div class="card-header">
                  <div class="status-badge pending">
                    <i class="bi bi-hourglass-split"></i>
                    Pendiente
                  </div>
                  <div class="consultation-type">
                    <i class="bi bi-person"></i>
                    Presencial
                  </div>
                </div>
                
                <div class="doctor-info">
                  <div class="doctor-avatar placeholder">
                    <i class="bi bi-person"></i>
                    <div class="status-indicator offline"></div>
                  </div>
                  <div class="doctor-details">
                    <h5>Por confirmar especialista</h5>
                    <span class="specialty">Gastroenterología</span>
                    <div class="experience">A confirmar</div>
                    <div class="rating">
                      <span class="text-muted">Sin calificación</span>
                    </div>
                  </div>
                </div>

                <div class="consultation-details">
                  <div class="detail-row">
                    <i class="bi bi-calendar3"></i>
                    <span>Martes 15 Feb, 3:00 PM - 4:00 PM</span>
                  </div>
                  <div class="detail-row">
                    <i class="bi bi-geo-alt"></i>
                    <span>Hospital MyHosp - Piso 3</span>
                  </div>
                  <div class="detail-row">
                    <i class="bi bi-clipboard2-pulse"></i>
                    <span>Problemas digestivos</span>
                  </div>
                </div>

                <div class="card-actions">
                  <button class="btn btn-outline-warning" disabled>
                    <i class="bi bi-hourglass-split me-2"></i>
                    Esperando confirmación
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Panel de ayuda -->
          <div class="row">
            <div class="col-12">
              <div class="help-panel">
                <div class="help-content">
                  <div class="help-icon">
                    <i class="bi bi-lightbulb"></i>
                  </div>
                  <div class="help-text">
                    <h6>Consejos para tu consulta online</h6>
                    <ul>
                      <li>Asegúrate de tener buena conexión a internet</li>
                      <li>Busca un lugar tranquilo y bien iluminado</li>
                      <li>Ten a mano tus documentos médicos</li>
                      <li>Prepara una lista de preguntas para el médico</li>
                    </ul>
                  </div>
                </div>
                <div class="help-assistant">
                  <img src="https://images.unsplash.com/photo-1551190822-a9333d879b1f?w=100&h=100&fit=crop&crop=center" 
                       alt="Asistente Ana" class="assistant-avatar">
                  <div class="assistant-info">
                    <h6>¿Necesitas ayuda?</h6>
                    <p>Ana está aquí para asistirte</p>
                    <button class="btn btn-sm btn-primary">
                      <i class="bi bi-chat-dots me-1"></i>
                      Hablar con Ana
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Completed Consultations Content (Initially Hidden) -->
        <div id="completed-content" class="tab-content">
          <div class="text-center py-5">
            <i class="bi bi-check-circle display-1 text-success mb-3"></i>
            <h4>Consultas Completadas</h4>
            <p class="text-muted mb-4">Historial de tus consultas médicas realizadas</p>
            
            <div class="row justify-content-center">
              <div class="col-lg-6">
                <div class="completed-consultation-card">
                  <div class="consultation-header">
                    <div class="doctor-info-mini">
                      <img src="https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=60&h=60&fit=crop&crop=face" 
                           alt="Dr. Pablo Ruiz" class="doctor-mini-avatar">
                      <div>
                        <h6 class="mb-0">Dr. Pablo Ruiz Hernández</h6>
                        <small class="text-muted">Medicina General</small>
                      </div>
                    </div>
                    <div class="consultation-date">
                      <i class="bi bi-calendar3"></i>
                      <span>10 Ene 2025</span>
                    </div>
                  </div>
                  
                  <div class="consultation-summary">
                    <div class="summary-item">
                      <i class="bi bi-clock"></i>
                      <span>Duración: 25 minutos</span>
                    </div>
                    <div class="summary-item">
                      <i class="bi bi-camera-video"></i>
                      <span>Videollamada</span>
                    </div>
                    <div class="summary-item rating">
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star"></i>
                      <span>4.0</span>
                    </div>
                  </div>
                  
                  <div class="consultation-actions">
                    <button class="btn btn-outline-primary btn-sm">
                      <i class="bi bi-file-text me-1"></i>
                      Ver resumen
                    </button>
                    <button class="btn btn-outline-secondary btn-sm">
                      <i class="bi bi-download me-1"></i>
                      Descargar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Specialists Content (Initially Hidden) -->
        <div id="specialists-content" class="tab-content">
          <div class="row">
            <div class="col-12 mb-4">
              <h4>Especialistas Disponibles</h4>
              <p class="text-muted">Conecta con nuestros especialistas certificados</p>
            </div>
          </div>
          
          <div class="row">
            <div class="col-lg-4 mb-4">
              <div class="specialist-card">
                <div class="specialist-header">
                  <img src="https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=100&h=100&fit=crop&crop=face" 
                       alt="Dr. García" class="specialist-avatar">
                  <div class="online-indicator"></div>
                </div>
                <div class="specialist-info">
                  <h5>Dr. Carlos García</h5>
                  <span class="specialty">Cardiología</span>
                  <div class="experience">15 años de experiencia</div>
                  <div class="rating">
                    <div class="stars">
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                    </div>
                    <span>5.0 (234 reseñas)</span>
                  </div>
                  <div class="availability">
                    <i class="bi bi-clock"></i>
                    <span>Disponible ahora</span>
                  </div>
                </div>
                <div class="specialist-actions">
                  <button class="btn btn-primary w-100" onclick="startVideoCall('Dr. Carlos García', 'cardiología')">
                    <i class="bi bi-camera-video me-2"></i>
                    Consultar Ahora
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

      <!-- Bootstrap JS -->
      <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

      <!-- Socket.IO -->
      <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
      <!-- Script de notificación inicial para el asistente -->
      <script src="./js/activation-prompt.js"></script>

      <!-- Script para notificación inicial sobre capacidades de Ana -->
      <script src="./js/initial-notification.js"></script>

      <!-- Script de consentimiento para Ana -->
      <script src="./js/ana-consent.js"></script>

      <!-- Script para controlar los botones del asistente -->
      <script src="./js/assistant-controls.js"></script>
      <!-- Asistente de voz -->
      <script type="module" src="./js/ViewModels/assistant.js"></script>      <!-- Botón de ayuda de Ana -->
      <script src="./js/ana-help-button.js"></script>      <script>
        // Verificar autenticación al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
          // Verificar si el usuario está logueado
          if (!localStorage.getItem('userLoggedIn')) {
            window.location.href = 'login.html';
            return;
          }

          // Actualizar nombre del usuario si está disponible
          const userName = localStorage.getItem('userName');
          if (userName) {
            const userGreeting = document.getElementById('userGreeting');
            if (userGreeting) {
              userGreeting.textContent = `Hola, ${userName}`;
            }
          }

          // Funcionalidad de logout
          const logoutBtn = document.getElementById('logoutBtn');
          if (logoutBtn) {
            logoutBtn.addEventListener('click', function(e) {
              e.preventDefault();
              if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
                // Limpiar datos de sesión
                localStorage.removeItem('userLoggedIn');
                localStorage.removeItem('userDocument');
                localStorage.removeItem('userName');
                
                // Redirigir al login
                window.location.href = 'login.html';
              }
            });
          }

          // Inicializar funcionalidades de la página
          initializeVideoCallFeatures();
          initializeTabSwitching();
        });

        // Variables globales para videollamada
        let localStream = null;
        let remoteStream = null;
        let peerConnection = null;
        let isVideoCallActive = false;

        // Inicializar funciones de videollamada
        function initializeVideoCallFeatures() {
          // Agregar estilos CSS para el modal de videollamada
          const style = document.createElement('style');
          style.textContent = `
            .video-call-modal {
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.9);
              z-index: 9999;
              display: none;
              flex-direction: column;
            }
            
            .video-call-header {
              background: #0d99b4;
              color: white;
              padding: 15px 20px;
              display: flex;
              justify-content: between;
              align-items: center;
            }
            
            .video-call-container {
              flex: 1;
              display: flex;
              position: relative;
              background: #000;
            }
            
            .video-main {
              flex: 1;
              display: flex;
              align-items: center;
              justify-content: center;
              position: relative;
            }
            
            .video-remote {
              width: 100%;
              height: 100%;
              object-fit: cover;
              background: #1a1a1a;
            }
            
            .video-local {
              position: absolute;
              top: 20px;
              right: 20px;
              width: 200px;
              height: 150px;
              object-fit: cover;
              border: 2px solid #0d99b4;
              border-radius: 8px;
              background: #1a1a1a;
            }
            
            .video-controls {
              background: #2c2c2c;
              padding: 20px;
              display: flex;
              justify-content: center;
              gap: 15px;
            }
            
            .control-btn {
              width: 50px;
              height: 50px;
              border: none;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              cursor: pointer;
              font-size: 20px;
              transition: transform 0.2s;
            }
            
            .control-btn:hover {
              transform: scale(1.1);
            }
            
            .control-btn.mute {
              background: #6c757d;
              color: white;
            }
            
            .control-btn.mute.active {
              background: #dc3545;
            }
            
            .control-btn.video {
              background: #6c757d;
              color: white;
            }
            
            .control-btn.video.active {
              background: #dc3545;
            }
            
            .control-btn.end {
              background: #dc3545;
              color: white;
            }
            
            .doctor-offline {
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              height: 100%;
              color: white;
              text-align: center;
            }
            
            .doctor-avatar {
              width: 120px;
              height: 120px;
              border-radius: 50%;
              margin-bottom: 20px;
              object-fit: cover;
            }
            
            .connecting-indicator {
              display: flex;
              align-items: center;
              gap: 10px;
              margin-top: 20px;
            }
            
            .spinner {
              width: 20px;
              height: 20px;
              border: 2px solid transparent;
              border-top: 2px solid #0d99b4;
              border-radius: 50%;
              animation: spin 1s linear infinite;
            }
            
            @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
            }
            
            .call-status {
              display: flex;
              align-items: center;
              gap: 10px;
            }
            
            .status-indicator {
              width: 12px;
              height: 12px;
              background: #28a745;
              border-radius: 50%;
              animation: pulse 2s infinite;
            }
            
            @keyframes pulse {
              0%, 100% { opacity: 1; }
              50% { opacity: 0.5; }
            }
          `;
          document.head.appendChild(style);
        }

        // Inicializar cambio de pestañas
        function initializeTabSwitching() {
          const navLinks = document.querySelectorAll('.nav-pills .nav-link');
          
          navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
              e.preventDefault();
              
              // Remover clase activa de todos los enlaces
              navLinks.forEach(l => l.classList.remove('active'));
              
              // Agregar clase activa al enlace clickeado
              this.classList.add('active');
              
              // Aquí se podría agregar lógica para cambiar el contenido
              if (this.textContent.trim() === 'Completas') {
                showCompletedConsultations();
              } else {
                showUpcomingConsultations();
              }
            });
          });
        }

        // Iniciar videollamada
        function startVideoCall(doctorName, specialty) {
          if (isVideoCallActive) {
            alert('Ya hay una videollamada en curso');
            return;
          }

          // Crear modal de videollamada
          const modal = createVideoCallModal(doctorName, specialty);
          document.body.appendChild(modal);
          
          // Mostrar modal
          modal.style.display = 'flex';
          isVideoCallActive = true;
          
          // Simular conexión
          simulateVideoConnection(doctorName);
          
          // Solicitar acceso a cámara y micrófono
          requestMediaAccess();
        }

        // Crear modal de videollamada
        function createVideoCallModal(doctorName, specialty) {
          const modal = document.createElement('div');
          modal.className = 'video-call-modal';
          modal.id = 'videoCallModal';
          
          modal.innerHTML = `
            <div class="video-call-header">
              <div>
                <h5 class="mb-0">Consulta con ${doctorName}</h5>
                <small>${specialty.charAt(0).toUpperCase() + specialty.slice(1)}</small>
              </div>
              <div class="call-status">
                <div class="status-indicator"></div>
                <span id="callStatus">Conectando...</span>
              </div>
            </div>
            
            <div class="video-call-container">
              <div class="video-main">
                <video id="remoteVideo" class="video-remote" autoplay playsinline></video>
                <video id="localVideo" class="video-local" autoplay muted playsinline></video>
                
                <div id="doctorOffline" class="doctor-offline">
                  <img src="https://www.future-doctor.de/wp-content/uploads/2024/08/shutterstock_2480850611.jpg" 
                       alt="${doctorName}" class="doctor-avatar">
                  <h4>${doctorName}</h4>
                  <p>Especialista en ${specialty}</p>
                  <div class="connecting-indicator">
                    <div class="spinner"></div>
                    <span>Conectando con el doctor...</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="video-controls">
              <button class="control-btn mute" id="muteBtn" onclick="toggleMute()">
                <i class="fas fa-microphone"></i>
              </button>
              <button class="control-btn video" id="videoBtn" onclick="toggleVideo()">
                <i class="fas fa-video"></i>
              </button>
              <button class="control-btn end" onclick="endCall()">
                <i class="fas fa-phone-slash"></i>
              </button>
            </div>
          `;
          
          return modal;
        }

        // Simular conexión de video
        function simulateVideoConnection(doctorName) {
          const callStatus = document.getElementById('callStatus');
          const doctorOffline = document.getElementById('doctorOffline');
          
          // Simular diferentes estados de conexión
          setTimeout(() => {
            callStatus.textContent = 'Llamando al doctor...';
          }, 2000);
          
          setTimeout(() => {
            callStatus.textContent = 'Doctor conectándose...';
          }, 4000);
          
          setTimeout(() => {
            callStatus.textContent = 'Llamada conectada';
            doctorOffline.style.display = 'none';
            
            // Mostrar notificación
            showNotification(`Conectado con ${doctorName}`, 'success');
          }, 6000);
        }

        // Solicitar acceso a medios
        async function requestMediaAccess() {
          try {
            const stream = await navigator.mediaDevices.getUserMedia({
              video: true,
              audio: true
            });
            
            localStream = stream;
            const localVideo = document.getElementById('localVideo');
            if (localVideo) {
              localVideo.srcObject = stream;
            }
            
          } catch (error) {
            console.error('Error accessing media devices:', error);
            showNotification('No se pudo acceder a la cámara o micrófono', 'error');
          }
        }

        // Toggle mute
        function toggleMute() {
          const muteBtn = document.getElementById('muteBtn');
          const icon = muteBtn.querySelector('i');
          
          if (localStream) {
            const audioTrack = localStream.getAudioTracks()[0];
            if (audioTrack) {
              audioTrack.enabled = !audioTrack.enabled;
              
              if (audioTrack.enabled) {
                muteBtn.classList.remove('active');
                icon.className = 'fas fa-microphone';
              } else {
                muteBtn.classList.add('active');
                icon.className = 'fas fa-microphone-slash';
              }
            }
          }
        }

        // Toggle video
        function toggleVideo() {
          const videoBtn = document.getElementById('videoBtn');
          const icon = videoBtn.querySelector('i');
          
          if (localStream) {
            const videoTrack = localStream.getVideoTracks()[0];
            if (videoTrack) {
              videoTrack.enabled = !videoTrack.enabled;
              
              if (videoTrack.enabled) {
                videoBtn.classList.remove('active');
                icon.className = 'fas fa-video';
              } else {
                videoBtn.classList.add('active');
                icon.className = 'fas fa-video-slash';
              }
            }
          }
        }

        // Finalizar llamada
        function endCall() {
          if (confirm('¿Estás seguro de que deseas finalizar la llamada?')) {
            // Detener streams
            if (localStream) {
              localStream.getTracks().forEach(track => track.stop());
              localStream = null;
            }
            
            // Cerrar modal
            const modal = document.getElementById('videoCallModal');
            if (modal) {
              modal.remove();
            }
            
            isVideoCallActive = false;
            showNotification('Llamada finalizada', 'info');
          }
        }

        // Mostrar consultas completadas
        function showCompletedConsultations() {
          const container = document.querySelector('.row.g-3');
          container.innerHTML = `
            <div class="col-12">
              <div class="text-center py-5">
                <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                <h4>Consultas Completadas</h4>
                <p class="text-muted">Aquí aparecerán las consultas que hayas realizado.</p>
                
                <div class="row mt-4">
                  <div class="col-md-6">
                    <div class="card p-3 shadow-sm">
                      <div class="d-flex align-items-center mb-2">
                        <img src="https://www.future-doctor.de/wp-content/uploads/2024/08/shutterstock_2480850611.jpg" alt="Doctor"
                          class="profile-img me-2">
                        <div>
                          <strong>Pablo Ruiz Hernández</strong><br>
                          <small>Medicina general | Completada el 10 Jan 2025</small>
                          <div class="card-specialty mt-1">Consulta finalizada</div>
                        </div>
                      </div>
                      <div class="mt-3 mb-2">
                        <strong>Duración: 25 minutos</strong><br>
                        <i class="bi bi-star-fill text-warning"></i> 
                        <i class="bi bi-star-fill text-warning"></i> 
                        <i class="bi bi-star-fill text-warning"></i> 
                        <i class="bi bi-star-fill text-warning"></i> 
                        <i class="bi bi-star text-warning"></i>
                      </div>
                      <button class="btn btn-outline-primary w-100">Ver resumen</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;
        }

        // Mostrar próximas consultas
        function showUpcomingConsultations() {
          location.reload(); // Recargar para mostrar el contenido original
        }

        // Sistema de notificaciones
        function showNotification(message, type = 'info') {
          const notification = document.createElement('div');
          notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} notification`;
          notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            min-width: 300px;
            animation: slideIn 0.3s ease-out;
          `;
          
          notification.innerHTML = `
            <div class="d-flex align-items-center">
              <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
              ${message}
              <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
            </div>
          `;
          
          document.body.appendChild(notification);
          
          // Auto-remove después de 5 segundos
          setTimeout(() => {
            if (notification.parentNode) {
              notification.remove();
            }
          }, 5000);
        }
      </script>
    </body>
  </html>
