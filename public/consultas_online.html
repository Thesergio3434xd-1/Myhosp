<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MyHosp - Consultas Online</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Google Fonts - Lexend -->
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- Estilos base modernos -->
  <link rel="stylesheet" href="./css/modern-design.css" />
  <!-- Estilos específicos de consultas online -->
  <link rel="stylesheet" href="./css/consultas-online.css" />
  <!-- Estilos del asistente Ana -->
  <link rel="stylesheet" href="./css/asistente.css" />
  <link rel="stylesheet" href="./css/ana-help-button.css" />
</head>

<body>
  <!-- Asistente de voz Ana -->
  <div id="ana-assistant" class="voice-assistant">
    <!-- Botones para controlar el asistente -->
    <div class="assistant-controls">
      <button id="enableAssistant" class="control-button enable-button" aria-label="Activar asistente de voz">
        <i class="fas fa-toggle-on"></i>
      </button>
      <button id="disableAssistant" class="control-button disable-button" aria-label="Desactivar asistente de voz">
        <i class="fas fa-toggle-off"></i>
      </button>
    </div>
    <button id="micButton" class="mic-button" aria-label="Activar asistente de voz">
      <i id="micIcon" class="fas fa-microphone"></i>
    </button>
    <div id="assistantStatus" class="assistant-status"></div>
  </div>
  
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-3 col-lg-2 px-0">
        <div class="sidebar d-flex flex-column position-fixed vh-100" style="width: 16.666667%; z-index: 1030;">
          <div class="text-center py-3">            <div class="logo">
              <img src="./img/logo.png" alt="MyHosp Logo" width="60" height="60" class="logo-image mb-2">
              <h5 class="text-white fw-bold mb-0">MyHosp</h5>
              <small class="text-white-50 fw-medium">Sistema Hospitalario</small>
            </div>
          </div>
          
          <nav class="nav flex-column flex-grow-1 px-3">
            <a class="nav-link" href="dashboard.index.html">
              <i class="bi bi-house-door"></i> Dashboard
            </a>
            <a class="nav-link" href="ver_citas.html">
              <i class="bi bi-calendar3"></i> Mis Citas
            </a>
            <a class="nav-link" href="crear_citas.html">
              <i class="bi bi-calendar-plus"></i> Nueva Cita
            </a>
            <a class="nav-link" href="historial_medico.html">
              <i class="bi bi-folder2-open"></i> Historial Médico
            </a>
            <a class="nav-link active" href="consultas_online.html">
              <i class="bi bi-camera-video"></i> Consulta Online
            </a>
            <a class="nav-link" href="perfil.html">
              <i class="bi bi-person"></i> Mi Perfil
            </a>
            <a class="nav-link" href="Ayuda.html">
              <i class="bi bi-question-circle"></i> Ayuda
            </a>
          </nav>
          
          <div class="mt-auto p-3">
            <button class="logout-btn w-100" onclick="handleLogout()">
              <i class="bi bi-box-arrow-left me-2"></i> Cerrar Sesión
            </button>
          </div>
        </div>
        
        <!-- Overlay para móvil -->
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
      </div>

      <!-- Contenido Principal -->
      <div class="col-md-9 col-lg-10" style="margin-left: 16.666667%;">
        <!-- Topbar -->
        <div class="topbar d-flex justify-content-between align-items-center px-4" style="height: 70px;">
          <div class="d-flex align-items-center">
            <!-- Botón hamburguesa para móvil -->
            <button class="mobile-menu-toggle me-3" type="button" onclick="toggleSidebar()">
              <i class="bi bi-list fs-5"></i>
            </button>
            <div>
              <h4 class="text-white mb-0">¡Bienvenido, <span id="username">Neymar Tapias</span>!</h4>
              <div class="d-flex align-items-center gap-2">
                <span class="text-white-50">Consultas Online</span>
                <span class="text-white-50">•</span>
                <span class="text-white-50 current-time"></span>
              </div>
            </div>
          </div>
          
          <div class="d-flex align-items-center gap-3">
            <!-- Dropdown idioma -->
            <div class="dropdown language-dropdown">
              <button class="btn btn-language text-white d-flex align-items-center gap-2" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <div class="flag-container">
                  <img src="https://flagcdn.com/w24/co.png" alt="ES" width="20" height="15" class="flag-image">
                </div>
                <span class="language-text">ES</span>
                <i class="bi bi-chevron-down small"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-end language-menu">
                <li>
                  <a class="dropdown-item language-option" href="#" data-lang="es">
                    <img src="https://flagcdn.com/w24/co.png" alt="ES" width="20" height="15" class="flag-image me-2">
                    <span>Español</span>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item language-option" href="#" data-lang="en">
                    <img src="https://flagcdn.com/w24/us.png" alt="EN" width="20" height="15" class="flag-image me-2">
                    <span>English</span>
                  </a>
                </li>
              </ul>
            </div>
            
            <!-- Notificaciones -->
            <div class="dropdown notifications-dropdown">
              <button class="btn btn-notification text-white position-relative" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-bell fs-5"></i>
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger notification-badge">3</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-end notifications-menu" style="min-width: 300px;">
                <li class="dropdown-header">
                  <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Notificaciones</h6>
                    <small class="text-muted">3 nuevas</small>
                  </div>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item notification-item" href="#">
                    <div class="d-flex align-items-start">
                      <div class="notification-icon bg-primary">
                        <i class="bi bi-camera-video text-white"></i>
                      </div>
                      <div class="notification-content">
                        <p class="mb-1 fw-medium">Consulta programada</p>
                        <small class="text-muted">Dr. García - Hoy 10:30 AM</small>
                      </div>
                    </div>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item notification-item" href="#">
                    <div class="d-flex align-items-start">
                      <div class="notification-icon bg-success">
                        <i class="bi bi-check-circle text-white"></i>
                      </div>
                      <div class="notification-content">
                        <p class="mb-1 fw-medium">Consulta completada</p>
                        <small class="text-muted">Revisión general finalizada</small>
                      </div>
                    </div>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item notification-item" href="#">
                    <div class="d-flex align-items-start">
                      <div class="notification-icon bg-warning">
                        <i class="bi bi-exclamation-triangle text-white"></i>
                      </div>
                      <div class="notification-content">
                        <p class="mb-1 fw-medium">Recordatorio</p>
                        <small class="text-muted">Verificar conexión antes de la cita</small>
                      </div>
                    </div>
                  </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item text-center text-primary" href="#">
                    Ver todas las notificaciones
                  </a>
                </li>
              </ul>
            </div>
            
            <!-- Perfil de usuario -->
            <div class="dropdown user-profile-dropdown">
              <button class="btn btn-user-profile text-white d-flex align-items-center gap-2" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop&crop=face" alt="Usuario" width="40" class="rounded-circle user-avatar">
                <div class="user-info-text d-none d-md-block">
                  <span class="user-name">Neymar Tapias</span>
                  <small class="user-role d-block text-white-50">Paciente</small>
                </div>
                <i class="bi bi-chevron-down small d-none d-md-inline"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-end user-menu">
                <li class="dropdown-header">
                  <div class="d-flex align-items-center">
                    <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=50&h=50&fit=crop&crop=face" alt="Usuario" width="50" class="rounded-circle me-3">
                    <div>
                      <h6 class="mb-0">Neymar Tapias</h6>
                      <small class="text-muted">paciente@myhosp.com</small>
                    </div>
                  </div>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item" href="perfil.html">
                    <i class="bi bi-person me-2 text-primary"></i>Mi Perfil
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="editar_perfil.html">
                    <i class="bi bi-gear me-2 text-secondary"></i>Configuración
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="Ayuda.html">
                    <i class="bi bi-question-circle me-2 text-info"></i>Ayuda
                  </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item text-danger" href="#" onclick="handleLogout()">
                    <i class="bi bi-box-arrow-left me-2"></i>Cerrar Sesión
                  </a>
                </li>              </ul>
            </div>
          </div>
        </div>
        
        <!-- Contenido del Dashboard -->
        <div class="container-fluid py-4">
          <!-- Sección Hero - Consulta Online -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card dashboard-welcome text-white fade-in-up">
                <div class="card-body p-4 position-relative" style="z-index: 2;">
                  <div class="row align-items-center">
                    <div class="col-md-8">
                      <div class="mb-2">
                        <span class="badge bg-light text-primary px-3 py-2 rounded-pill">
                          <i class="bi bi-camera-video me-1"></i>Consulta Online
                        </span>
                      </div>
                      <h3 class="card-title mb-3 fw-bold">Atención médica desde tu hogar</h3>
                      <p class="card-text mb-4 fs-5">Consulta con nuestros especialistas certificados a través de videollamada segura. Disponible 24/7 para tu comodidad.</p>
                      <div class="d-flex align-items-center mb-4">
                        <div class="d-flex me-3">
                          <img src="https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=40&h=40&fit=crop&crop=face" alt="Doctor" class="rounded-circle me-2 border border-white border-2" width="40">
                          <img src="https://images.unsplash.com/photo-1582750433449-648ed127bb54?w=40&h=40&fit=crop&crop=face" alt="Doctora" class="rounded-circle me-2 border border-white border-2" width="40">
                          <img src="https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=40&h=40&fit=crop&crop=face" alt="Doctor" class="rounded-circle me-2 border border-white border-2" width="40">
                          <div class="rounded-circle bg-white text-primary d-flex align-items-center justify-content-center fw-bold" style="width: 40px; height: 40px; font-size: 0.8rem;">+25</div>
                        </div>
                        <span class="text-white-75 fw-medium">28 especialistas en línea</span>
                      </div>
                      <button class="btn btn-light btn-lg px-4 py-3 rounded-pill shadow" onclick="startNewConsultation()">
                        <i class="bi bi-camera-video me-2"></i>Iniciar Consulta Ahora
                      </button>
                    </div>
                    <div class="col-md-4 text-center">
                      <img src="https://images.unsplash.com/photo-1631815589968-fdb09a223b1e?w=300&h=250&fit=crop&crop=center" alt="Consulta Online" class="img-fluid rounded-4 shadow-lg" style="max-height: 250px;">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Navigation Pills -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card">
                <div class="card-body p-3">
                  <nav class="consultation-nav d-flex gap-2">
                    <button class="btn btn-primary px-4 py-2 rounded-pill" id="tab-upcoming" onclick="showTab('upcoming')">
                      <i class="bi bi-calendar-event me-2"></i>Próximas Consultas
                      <span class="badge bg-light text-primary ms-2">3</span>
                    </button>
                    <button class="btn btn-outline-primary px-4 py-2 rounded-pill" id="tab-completed" onclick="showTab('completed')">
                      <i class="bi bi-check-circle me-2"></i>Consultas Completadas
                    </button>
                    <button class="btn btn-outline-primary px-4 py-2 rounded-pill" id="tab-specialists" onclick="showTab('specialists')">
                      <i class="bi bi-people me-2"></i>Especialistas Disponibles
                    </button>
                  </nav>
                </div>
              </div>
            </div>
          </div>

          <!-- Upcoming Consultations Content -->
          <div id="upcoming-content" class="tab-content">
            <div class="row">
              <!-- Consulta Inmediata -->
              <div class="col-lg-4 mb-4">
                <div class="card consultation-card border-0 shadow-sm h-100">
                  <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                      <i class="bi bi-exclamation-circle me-2"></i>
                      <span class="fw-bold">En 15 minutos</span>
                    </div>
                    <div class="consultation-type">
                      <i class="bi bi-camera-video"></i>
                    </div>
                  </div>
                  
                  <div class="card-body">
                    <div class="doctor-info d-flex align-items-center mb-3">
                      <div class="position-relative me-3">
                        <img src="https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=60&h=60&fit=crop&crop=face" 
                             alt="Dr. Pablo Ruiz" class="rounded-circle" width="60" height="60">
                        <div class="position-absolute bottom-0 end-0 bg-success rounded-circle border border-white" style="width: 16px; height: 16px;"></div>
                      </div>
                      <div>
                        <h6 class="card-title mb-1 fw-bold">Dr. Pablo Ruiz Hernández</h6>
                        <p class="text-muted mb-1 small">Medicina General</p>
                        <div class="d-flex align-items-center small">
                          <div class="text-warning me-2">
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-half"></i>
                          </div>
                          <span class="text-muted">4.8 (89)</span>
                        </div>
                      </div>
                    </div>

                    <div class="consultation-details mb-3">
                      <div class="d-flex align-items-center mb-2 small">
                        <i class="bi bi-calendar3 text-primary me-2"></i>
                        <span>Hoy, 2:00 PM - 2:30 PM</span>
                      </div>
                      <div class="d-flex align-items-center mb-2 small">
                        <i class="bi bi-geo-alt text-primary me-2"></i>
                        <span>Consulta Virtual</span>
                      </div>
                      <div class="d-flex align-items-center small">
                        <i class="bi bi-clipboard2-pulse text-primary me-2"></i>
                        <span>Consulta de rutina</span>
                      </div>
                    </div>

                    <div class="d-grid gap-2">
                      <button class="btn btn-primary" onclick="startVideoCall('Dr. Pablo Ruiz Hernández', 'medicina general')">
                        <i class="bi bi-camera-video me-2"></i>
                        Iniciar Consulta
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Consulta Programada -->
              <div class="col-lg-4 mb-4">
                <div class="card consultation-card border-0 shadow-sm h-100">
                  <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                      <i class="bi bi-clock me-2"></i>
                      <span class="fw-bold">Programada</span>
                    </div>
                    <div class="consultation-type">
                      <i class="bi bi-camera-video"></i>
                    </div>
                  </div>
                  
                  <div class="card-body">
                    <div class="doctor-info d-flex align-items-center mb-3">
                      <div class="position-relative me-3">
                        <img src="https://images.unsplash.com/photo-1594824731083-7fb4b02c7a4e?w=60&h=60&fit=crop&crop=face" 
                             alt="Dra. Amanda Otero" class="rounded-circle" width="60" height="60">
                        <div class="position-absolute bottom-0 end-0 bg-success rounded-circle border border-white" style="width: 16px; height: 16px;"></div>
                      </div>
                      <div>
                        <h6 class="card-title mb-1 fw-bold">Dra. Amanda Otero Ramos</h6>
                        <p class="text-muted mb-1 small">Psicología</p>
                        <div class="d-flex align-items-center small">
                          <div class="text-warning me-2">
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                          </div>
                          <span class="text-muted">5.0 (156)</span>
                        </div>
                      </div>
                    </div>

                    <div class="consultation-details mb-3">
                      <div class="d-flex align-items-center mb-2 small">
                        <i class="bi bi-calendar3 text-primary me-2"></i>
                        <span>Lunes, 10:00 AM - 11:00 AM</span>
                      </div>
                      <div class="d-flex align-items-center mb-2 small">
                        <i class="bi bi-geo-alt text-primary me-2"></i>
                        <span>Consulta Virtual</span>
                      </div>
                      <div class="d-flex align-items-center small">
                        <i class="bi bi-clipboard2-pulse text-primary me-2"></i>
                        <span>Terapia psicológica</span>
                      </div>
                    </div>

                    <div class="d-grid gap-2">
                      <button class="btn btn-outline-primary" disabled>
                        <i class="bi bi-calendar-check me-2"></i>
                        Programada
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Consulta Pendiente -->
              <div class="col-lg-4 mb-4">
                <div class="card consultation-card border-0 shadow-sm h-100">
                  <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                      <i class="bi bi-hourglass-split me-2"></i>
                      <span class="fw-bold">Pendiente</span>
                    </div>
                    <div class="consultation-type">
                      <i class="bi bi-person"></i>
                    </div>
                  </div>
                  
                  <div class="card-body">
                    <div class="doctor-info d-flex align-items-center mb-3">
                      <div class="position-relative me-3">
                        <div class="rounded-circle bg-light d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                          <i class="bi bi-person fs-4 text-muted"></i>
                        </div>
                        <div class="position-absolute bottom-0 end-0 bg-secondary rounded-circle border border-white" style="width: 16px; height: 16px;"></div>
                      </div>
                      <div>
                        <h6 class="card-title mb-1 fw-bold">Por confirmar especialista</h6>
                        <p class="text-muted mb-1 small">Gastroenterología</p>
                        <div class="d-flex align-items-center small">
                          <span class="text-muted">A confirmar</span>
                        </div>
                      </div>
                    </div>

                    <div class="consultation-details mb-3">
                      <div class="d-flex align-items-center mb-2 small">
                        <i class="bi bi-calendar3 text-primary me-2"></i>
                        <span>Martes 15 Feb, 3:00 PM - 4:00 PM</span>
                      </div>
                      <div class="d-flex align-items-center mb-2 small">
                        <i class="bi bi-geo-alt text-primary me-2"></i>
                        <span>Presencial</span>
                      </div>
                      <div class="d-flex align-items-center small">
                        <i class="bi bi-clipboard2-pulse text-primary me-2"></i>
                        <span>Consulta especializada</span>
                      </div>
                    </div>

                    <div class="d-grid gap-2">
                      <button class="btn btn-outline-warning">
                        <i class="bi bi-hourglass-split me-2"></i>
                        Esperando confirmación
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Completed Consultations Content -->
          <div id="completed-content" class="tab-content d-none">
            <div class="row">
              <div class="col-12">
                <div class="card">
                  <div class="card-body">
                    <div class="text-center py-5">
                      <i class="bi bi-check-circle text-success" style="font-size: 4rem;"></i>
                      <h4 class="mt-3 mb-2">Consultas Completadas</h4>
                      <p class="text-muted mb-4">Aquí verás el historial de tus consultas finalizadas</p>
                      <button class="btn btn-primary">
                        <i class="bi bi-plus-circle me-2"></i>Agendar Nueva Consulta
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Specialists Available Content -->
          <div id="specialists-content" class="tab-content d-none">
            <div class="row">
              <!-- Especialista 1 -->
              <div class="col-lg-6 mb-4">
                <div class="card specialist-card border-0 shadow-sm">
                  <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                      <div class="position-relative me-3">
                        <img src="https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=80&h=80&fit=crop&crop=face" 
                             alt="Dr. Carlos García" class="rounded-circle" width="80" height="80">
                        <div class="position-absolute bottom-0 end-0 bg-success rounded-circle border border-white" style="width: 20px; height: 20px;"></div>
                      </div>
                      <div class="flex-grow-1">
                        <h5 class="card-title mb-1 fw-bold">Dr. Carlos García Mendez</h5>
                        <p class="text-primary mb-1 fw-medium">Cardiología</p>
                        <p class="text-muted small mb-2">15 años de experiencia</p>
                        <div class="d-flex align-items-center">
                          <div class="text-warning me-2">
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                          </div>
                          <span class="text-muted small">5.0 (234 reseñas)</span>
                        </div>
                      </div>
                      <div class="text-end">
                        <span class="badge bg-success rounded-pill px-3 py-2">Disponible</span>
                        <p class="text-muted small mb-0 mt-1">Responde en ~5 min</p>
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <h6 class="fw-bold mb-2">Especialidades:</h6>
                      <div class="d-flex flex-wrap gap-2">
                        <span class="badge bg-light text-dark">Cardiología General</span>
                        <span class="badge bg-light text-dark">Ecocardiograma</span>
                        <span class="badge bg-light text-dark">Hipertensión</span>
                      </div>
                    </div>

                    <div class="d-grid">
                      <button class="btn btn-primary" onclick="scheduleConsultation('Dr. Carlos García', 'Cardiología')">
                        <i class="bi bi-calendar-plus me-2"></i>Agendar Consulta
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Especialista 2 -->
              <div class="col-lg-6 mb-4">
                <div class="card specialist-card border-0 shadow-sm">
                  <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                      <div class="position-relative me-3">
                        <img src="https://images.unsplash.com/photo-1582750433449-648ed127bb54?w=80&h=80&fit=crop&crop=face" 
                             alt="Dra. María López" class="rounded-circle" width="80" height="80">
                        <div class="position-absolute bottom-0 end-0 bg-success rounded-circle border border-white" style="width: 20px; height: 20px;"></div>
                      </div>
                      <div class="flex-grow-1">
                        <h5 class="card-title mb-1 fw-bold">Dra. María López Rivera</h5>
                        <p class="text-primary mb-1 fw-medium">Dermatología</p>
                        <p class="text-muted small mb-2">10 años de experiencia</p>
                        <div class="d-flex align-items-center">
                          <div class="text-warning me-2">
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-half"></i>
                          </div>
                          <span class="text-muted small">4.9 (187 reseñas)</span>
                        </div>
                      </div>
                      <div class="text-end">
                        <span class="badge bg-success rounded-pill px-3 py-2">Disponible</span>
                        <p class="text-muted small mb-0 mt-1">Responde en ~3 min</p>
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <h6 class="fw-bold mb-2">Especialidades:</h6>
                      <div class="d-flex flex-wrap gap-2">
                        <span class="badge bg-light text-dark">Dermatología General</span>
                        <span class="badge bg-light text-dark">Acné</span>
                        <span class="badge bg-light text-dark">Estética</span>
                      </div>
                    </div>

                    <div class="d-grid">
                      <button class="btn btn-primary" onclick="scheduleConsultation('Dra. María López', 'Dermatología')">
                        <i class="bi bi-calendar-plus me-2"></i>Agendar Consulta
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Actions Section -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <h5 class="card-title mb-0">
                    <i class="bi bi-lightning me-2 text-warning"></i>Acciones Rápidas
                  </h5>
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-md-3">
                      <button class="btn btn-outline-primary w-100 p-3 h-100" onclick="startNewConsultation()">
                        <i class="bi bi-camera-video fs-4 d-block mb-2"></i>
                        <span class="fw-medium">Nueva Consulta</span>
                      </button>
                    </div>
                    <div class="col-md-3">
                      <button class="btn btn-outline-success w-100 p-3 h-100" onclick="viewHistory()">
                        <i class="bi bi-clock-history fs-4 d-block mb-2"></i>
                        <span class="fw-medium">Ver Historial</span>
                      </button>
                    </div>
                    <div class="col-md-3">
                      <button class="btn btn-outline-info w-100 p-3 h-100" onclick="testConnection()">
                        <i class="bi bi-wifi fs-4 d-block mb-2"></i>
                        <span class="fw-medium">Test Conexión</span>
                      </button>
                    </div>
                    <div class="col-md-3">
                      <button class="btn btn-outline-warning w-100 p-3 h-100" onclick="downloadApp()">
                        <i class="bi bi-download fs-4 d-block mb-2"></i>
                        <span class="fw-medium">Descargar App</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript Files -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  
  <!-- Asistente de voz Scripts -->
  <script src="./js/activation-prompt.js"></script>
  <script src="./js/initial-notification.js"></script>
  <script src="./js/ana-consent.js"></script>
  <script src="./js/assistant-controls.js"></script>
  <script type="module" src="./js/ViewModels/assistant.js"></script>
  <script src="./js/ana-help-button.js"></script>

  <script>
    // Variables globales
    let currentTab = 'upcoming';
    let isVideoCallActive = false;
    let localStream = null;

    // Inicialización del documento
    document.addEventListener('DOMContentLoaded', function() {
      // Verificar autenticación
      if (!localStorage.getItem('userLoggedIn')) {
        window.location.href = 'login.html';
        return;
      }

      // Actualizar nombre del usuario
      const userName = localStorage.getItem('userName');
      if (userName) {
        const userElements = document.querySelectorAll('#username, .user-name');
        userElements.forEach(el => el.textContent = userName);
      }

      // Inicializar reloj
      updateCurrentTime();
      setInterval(updateCurrentTime, 1000);

      // Inicializar funcionalidades
      initializeTabSwitching();
      initializeVideoCallFeatures();
    });

    // Función para actualizar la hora actual
    function updateCurrentTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('es-ES', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      const timeElements = document.querySelectorAll('.current-time');
      timeElements.forEach(el => el.textContent = timeString);
    }

    // Función para manejar el logout
    function handleLogout() {
      if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
        localStorage.removeItem('userLoggedIn');
        localStorage.removeItem('userDocument');
        localStorage.removeItem('userName');
        window.location.href = 'login.html';
      }
    }

    // Función para toggle del sidebar en móvil
    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.querySelector('.sidebar-overlay');
      
      if (sidebar && overlay) {
        sidebar.classList.toggle('show');
        overlay.classList.toggle('show');
      }
    }

    // Funciones de navegación por pestañas
    function showTab(tabName) {
      // Actualizar botones de navegación
      const tabButtons = document.querySelectorAll('[id^="tab-"]');
      tabButtons.forEach(btn => {
        btn.className = 'btn btn-outline-primary px-4 py-2 rounded-pill';
      });
      
      document.getElementById(`tab-${tabName}`).className = 'btn btn-primary px-4 py-2 rounded-pill';

      // Mostrar/ocultar contenido
      const contents = document.querySelectorAll('[id$="-content"]');
      contents.forEach(content => content.classList.add('d-none'));
      
      document.getElementById(`${tabName}-content`).classList.remove('d-none');
      
      currentTab = tabName;
    }

    function initializeTabSwitching() {
      // Los botones ya tienen onclick en el HTML
      showTab('upcoming'); // Mostrar pestaña inicial
    }

    // Funciones de videollamada
    function initializeVideoCallFeatures() {
      // Agregar estilos CSS para el modal de videollamada si no existen
      if (!document.getElementById('videoCallStyles')) {
        const style = document.createElement('style');
        style.id = 'videoCallStyles';
        style.textContent = `
          .video-call-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: none;
            flex-direction: column;
          }
          
          .video-call-header {
            background: linear-gradient(135deg, #0d99b4, #17a2b8);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
          }
          
          .video-call-container {
            flex: 1;
            display: flex;
            position: relative;
            background: #000;
          }
          
          .video-main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
          }
          
          .video-local {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            object-fit: cover;
            border: 3px solid #0d99b4;
            border-radius: 12px;
            background: #1a1a1a;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
          }
          
          .doctor-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: white;
            text-align: center;
          }
          
          .doctor-avatar-large {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin-bottom: 20px;
            object-fit: cover;
            border: 4px solid #0d99b4;
          }
          
          .video-controls {
            background: linear-gradient(135deg, #2c2c2c, #3c3c3c);
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
          }
          
          .control-btn {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
          }
          
          .control-btn:hover {
            transform: scale(1.1);
          }
          
          .control-btn.mute {
            background: #6c757d;
            color: white;
          }
          
          .control-btn.mute.active {
            background: #dc3545;
          }
          
          .control-btn.video {
            background: #6c757d;
            color: white;
          }
          
          .control-btn.video.active {
            background: #dc3545;
          }
          
          .control-btn.end {
            background: #dc3545;
            color: white;
          }
          
          .call-status {
            display: flex;
            align-items: center;
            gap: 10px;
          }
          
          .status-indicator {
            width: 12px;
            height: 12px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
          }
          
          @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
          }
          
          .connecting-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid transparent;
            border-top: 3px solid #0d99b4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
          }
          
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `;
        document.head.appendChild(style);
      }
    }

    // Función para iniciar nueva consulta
    function startNewConsultation() {
      showNotification('Buscando especialistas disponibles...', 'info');
      
      setTimeout(() => {
        showTab('specialists');
        showNotification('¡Especialistas encontrados! Selecciona uno para iniciar tu consulta.', 'success');
      }, 2000);
    }

    // Función para iniciar videollamada
    function startVideoCall(doctorName, specialty) {
      if (isVideoCallActive) {
        showNotification('Ya hay una videollamada en curso', 'warning');
        return;
      }

      // Crear y mostrar modal de videollamada
      const modal = createVideoCallModal(doctorName, specialty);
      document.body.appendChild(modal);
      modal.style.display = 'flex';
      isVideoCallActive = true;
      
      // Solicitar acceso a medios y simular conexión
      requestMediaAccess();
      simulateConnection(doctorName);
    }

    // Crear modal de videollamada
    function createVideoCallModal(doctorName, specialty) {
      const modal = document.createElement('div');
      modal.className = 'video-call-modal';
      modal.id = 'videoCallModal';
      
      modal.innerHTML = `
        <div class="video-call-header">
          <div>
            <h5 class="mb-0">Consulta con ${doctorName}</h5>
            <small class="text-white-50">${specialty.charAt(0).toUpperCase() + specialty.slice(1)}</small>
          </div>
          <div class="call-status">
            <div class="status-indicator"></div>
            <span id="callStatus">Conectando...</span>
          </div>
        </div>
        
        <div class="video-call-container">
          <div class="video-main">
            <div id="doctorPlaceholder" class="doctor-placeholder">
              <img src="https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=150&h=150&fit=crop&crop=face" 
                   alt="${doctorName}" class="doctor-avatar-large">
              <h4>${doctorName}</h4>
              <p class="text-white-50">Especialista en ${specialty}</p>
              <div class="connecting-spinner"></div>
              <p id="connectionMessage">Conectando con el doctor...</p>
            </div>
            <video id="localVideo" class="video-local" autoplay muted playsinline></video>
          </div>
        </div>
        
        <div class="video-controls">
          <button class="control-btn mute" id="muteBtn" onclick="toggleMute()" title="Silenciar micrófono">
            <i class="bi bi-mic"></i>
          </button>
          <button class="control-btn video" id="videoBtn" onclick="toggleVideo()" title="Activar/desactivar cámara">
            <i class="bi bi-camera-video"></i>
          </button>
          <button class="control-btn end" onclick="endCall()" title="Finalizar llamada">
            <i class="bi bi-telephone-x"></i>
          </button>
        </div>
      `;
      
      return modal;
    }

    // Solicitar acceso a medios
    async function requestMediaAccess() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: true,
          audio: true
        });
        
        localStream = stream;
        const localVideo = document.getElementById('localVideo');
        if (localVideo) {
          localVideo.srcObject = stream;
        }
        
      } catch (error) {
        console.error('Error accessing media devices:', error);
        showNotification('No se pudo acceder a la cámara o micrófono. Verifica los permisos.', 'error');
      }
    }

    // Simular conexión con el doctor
    function simulateConnection(doctorName) {
      const callStatus = document.getElementById('callStatus');
      const connectionMessage = document.getElementById('connectionMessage');
      
      const steps = [
        { time: 1000, status: 'Verificando conexión...', message: 'Verificando tu conexión a internet...' },
        { time: 2500, status: 'Llamando al doctor...', message: 'Contactando con el doctor...' },
        { time: 4000, status: 'Doctor conectándose...', message: 'El doctor está ingresando a la consulta...' },
        { time: 6000, status: 'Conectado', message: 'Consulta iniciada con éxito' }
      ];
      
      steps.forEach(step => {
        setTimeout(() => {
          if (callStatus) callStatus.textContent = step.status;
          if (connectionMessage) connectionMessage.textContent = step.message;
          
          if (step.status === 'Conectado') {
            const placeholder = document.getElementById('doctorPlaceholder');
            if (placeholder) {
              placeholder.innerHTML = `
                <div class="text-center">
                  <i class="bi bi-camera-video text-success" style="font-size: 4rem;"></i>
                  <h4 class="mt-3 text-success">¡Conectado con ${doctorName}!</h4>
                  <p class="text-white-50">La consulta ha comenzado</p>
                </div>
              `;
            }
            showNotification(`Conectado exitosamente con ${doctorName}`, 'success');
          }
        }, step.time);
      });
    }

    // Funciones de control de videollamada
    function toggleMute() {
      const muteBtn = document.getElementById('muteBtn');
      const icon = muteBtn.querySelector('i');
      
      if (localStream) {
        const audioTrack = localStream.getAudioTracks()[0];
        if (audioTrack) {
          audioTrack.enabled = !audioTrack.enabled;
          
          if (audioTrack.enabled) {
            muteBtn.classList.remove('active');
            icon.className = 'bi bi-mic';
            muteBtn.title = 'Silenciar micrófono';
          } else {
            muteBtn.classList.add('active');
            icon.className = 'bi bi-mic-mute';
            muteBtn.title = 'Activar micrófono';
          }
        }
      }
    }

    function toggleVideo() {
      const videoBtn = document.getElementById('videoBtn');
      const icon = videoBtn.querySelector('i');
      
      if (localStream) {
        const videoTrack = localStream.getVideoTracks()[0];
        if (videoTrack) {
          videoTrack.enabled = !videoTrack.enabled;
          
          if (videoTrack.enabled) {
            videoBtn.classList.remove('active');
            icon.className = 'bi bi-camera-video';
            videoBtn.title = 'Desactivar cámara';
          } else {
            videoBtn.classList.add('active');
            icon.className = 'bi bi-camera-video-off';
            videoBtn.title = 'Activar cámara';
          }
        }
      }
    }

    function endCall() {
      if (confirm('¿Estás seguro de que deseas finalizar la llamada?')) {
        // Detener streams
        if (localStream) {
          localStream.getTracks().forEach(track => track.stop());
          localStream = null;
        }
        
        // Cerrar modal
        const modal = document.getElementById('videoCallModal');
        if (modal) {
          modal.remove();
        }
        
        isVideoCallActive = false;
        showNotification('Llamada finalizada correctamente', 'info');
      }
    }

    // Funciones adicionales
    function scheduleConsultation(doctorName, specialty) {
      showNotification(`Agendando consulta con ${doctorName} (${specialty})...`, 'info');
      
      setTimeout(() => {
        showNotification('¡Consulta agendada exitosamente! Recibirás una confirmación por email.', 'success');
      }, 2000);
    }

    function viewHistory() {
      showTab('completed');
    }

    function testConnection() {
      showNotification('Probando conexión...', 'info');
      
      setTimeout(() => {
        const speed = Math.floor(Math.random() * 50) + 20;
        showNotification(`Conexión estable: ${speed} Mbps. ¡Perfecto para videollamadas!`, 'success');
      }, 3000);
    }

    function downloadApp() {
      showNotification('Descarga disponible próximamente en App Store y Google Play', 'info');
    }

    // Sistema de notificaciones
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      const alertClass = type === 'success' ? 'alert-success' : 
                        type === 'error' ? 'alert-danger' : 
                        type === 'warning' ? 'alert-warning' : 'alert-info';
      
      notification.className = `alert ${alertClass} notification`;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10001;
        min-width: 350px;
        max-width: 500px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        border: none;
        border-radius: 12px;
        animation: slideInRight 0.3s ease-out;
      `;
      
      const iconClass = type === 'success' ? 'bi-check-circle' : 
                       type === 'error' ? 'bi-exclamation-triangle' : 
                       type === 'warning' ? 'bi-exclamation-circle' : 'bi-info-circle';
      
      notification.innerHTML = `
        <div class="d-flex align-items-center">
          <i class="bi ${iconClass} me-2"></i>
          <span class="flex-grow-1">${message}</span>
          <button type="button" class="btn-close ms-2" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Auto-remove después de 5 segundos
      setTimeout(() => {
        if (notification.parentNode) {
          notification.style.animation = 'slideOutRight 0.3s ease-in';
          setTimeout(() => notification.remove(), 300);
        }
      }, 5000);
    }

    // Agregar animaciones CSS para las notificaciones
    if (!document.getElementById('notificationStyles')) {
      const style = document.createElement('style');
      style.id = 'notificationStyles';
      style.textContent = `
        @keyframes slideInRight {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
        
        @keyframes slideOutRight {
          from {
            transform: translateX(0);
            opacity: 1;
          }
          to {
            transform: translateX(100%);
            opacity: 0;
          }
        }
        
        .fade-in-up {
          animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        .consultation-card {
          transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .consultation-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
        }
        
        .specialist-card {
          transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .specialist-card:hover {
          transform: translateY(-3px);
          box-shadow: 0 6px 20px rgba(0,0,0,0.1) !important;
        }
        
        @media (max-width: 768px) {
          .notification {
            min-width: 300px !important;
            max-width: calc(100vw - 40px) !important;
          }
          
          .video-call-modal .video-local {
            width: 120px !important;
            height: 90px !important;
            top: 10px !important;
            right: 10px !important;
          }
          
          .video-controls {
            padding: 15px !important;
            gap: 15px !important;
          }
          
          .control-btn {
            width: 50px !important;
            height: 50px !important;
            font-size: 20px !important;
          }
        }
      `;
      document.head.appendChild(style);
    }
  </script>

</body>
</html>
